/*! For license information please see main_2.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class l extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h.prototype.create)}}class h{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(d,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new l(r,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(p(n)&&p(s)){if(!f(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}function g(t,e=1e3,n=2){const r=e*Math.pow(n,t),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function m(t){return t&&t._delegate?t._delegate:t}class y{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const v="[DEFAULT]";class w{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:v})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=v){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=v){return this.instances.has(t)}getOptions(t=v){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===v?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=v){return this.component?this.component.multipleInstances?t:v:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class b{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new w(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const _=[];var E;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(E||(E={}));const T={debug:E.DEBUG,verbose:E.VERBOSE,info:E.INFO,warn:E.WARN,error:E.ERROR,silent:E.SILENT},I=E.INFO,S={[E.DEBUG]:"log",[E.VERBOSE]:"log",[E.INFO]:"info",[E.WARN]:"warn",[E.ERROR]:"error"},C=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=S[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class A{constructor(t){this.name=t,this._logLevel=I,this._logHandler=C,this._userLogHandler=null,_.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in E))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?T[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,E.DEBUG,...t),this._logHandler(this,E.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,E.VERBOSE,...t),this._logHandler(this,E.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,E.INFO,...t),this._logHandler(this,E.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,E.WARN,...t),this._logHandler(this,E.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,E.ERROR,...t),this._logHandler(this,E.ERROR,...t)}}let D,N;const k=new WeakMap,x=new WeakMap,R=new WeakMap,L=new WeakMap,O=new WeakMap;let M={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return x.get(t);if("objectStoreNames"===e)return t.objectStoreNames||R.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return V(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function P(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(N||(N=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(F(this),t),V(k.get(this))}:function(...t){return V(e.apply(F(this),t))}:function(t,...n){const r=e.call(F(this),t,...n);return R.set(r,t.sort?t.sort():[t]),V(r)}:(t instanceof IDBTransaction&&function(t){if(x.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));x.set(t,e)}(t),n=t,(D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,M):t);var e,n}function V(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(V(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&k.set(e,t)})).catch((()=>{})),O.set(e,t),e}(t);if(L.has(t))return L.get(t);const e=P(t);return e!==t&&(L.set(t,e),O.set(e,t)),e}const F=t=>O.get(t);function U(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=V(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(V(o.result),t.oldVersion,t.newVersion,V(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const B=["get","getKey","getAll","getAllKeys","count"],j=["put","add","delete","clear"],q=new Map;function $(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(q.get(e))return q.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=j.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!B.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return q.set(e,s),s}var z;z=M,M={...z,get:(t,e,n)=>$(t,e)||z.get(t,e,n),has:(t,e)=>!!$(t,e)||z.has(t,e)};class K{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const G="@firebase/app",H="0.10.15",Q=new A("@firebase/app"),W="@firebase/app-compat",X="@firebase/analytics-compat",Y="@firebase/analytics",J="@firebase/app-check-compat",Z="@firebase/app-check",tt="@firebase/auth",et="@firebase/auth-compat",nt="@firebase/database",rt="@firebase/data-connect",it="@firebase/database-compat",st="@firebase/functions",ot="@firebase/functions-compat",at="@firebase/installations",ct="@firebase/installations-compat",ut="@firebase/messaging",lt="@firebase/messaging-compat",ht="@firebase/performance",dt="@firebase/performance-compat",ft="@firebase/remote-config",pt="@firebase/remote-config-compat",gt="@firebase/storage",mt="@firebase/storage-compat",yt="@firebase/firestore",vt="@firebase/vertexai",wt="@firebase/firestore-compat",bt="firebase",_t="[DEFAULT]",Et={[G]:"fire-core",[W]:"fire-core-compat",[Y]:"fire-analytics",[X]:"fire-analytics-compat",[Z]:"fire-app-check",[J]:"fire-app-check-compat",[tt]:"fire-auth",[et]:"fire-auth-compat",[nt]:"fire-rtdb",[rt]:"fire-data-connect",[it]:"fire-rtdb-compat",[st]:"fire-fn",[ot]:"fire-fn-compat",[at]:"fire-iid",[ct]:"fire-iid-compat",[ut]:"fire-fcm",[lt]:"fire-fcm-compat",[ht]:"fire-perf",[dt]:"fire-perf-compat",[ft]:"fire-rc",[pt]:"fire-rc-compat",[gt]:"fire-gcs",[mt]:"fire-gcs-compat",[yt]:"fire-fst",[wt]:"fire-fst-compat",[vt]:"fire-vertex","fire-js":"fire-js",[bt]:"fire-js-all"},Tt=new Map,It=new Map,St=new Map;function Ct(t,e){try{t.container.addComponent(e)}catch(n){Q.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function At(t){const e=t.name;if(St.has(e))return Q.debug(`There were multiple attempts to register component ${e}.`),!1;St.set(e,t);for(const e of Tt.values())Ct(e,t);for(const e of It.values())Ct(e,t);return!0}function Dt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Nt=new h("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class kt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new y("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Nt.create("app-deleted",{appName:this._name})}}function xt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:_t,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw Nt.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw Nt.create("no-options");const s=Tt.get(i);if(s){if(f(n,s.options)&&f(r,s.config))return s;throw Nt.create("duplicate-app",{appName:i})}const a=new b(i);for(const t of St.values())a.addComponent(t);const c=new kt(n,r,a);return Tt.set(i,c),c}function Rt(t=_t){const e=Tt.get(t);if(!e&&t===_t&&o())return xt();if(!e)throw Nt.create("no-app",{appName:t});return e}function Lt(t,e,n){var r;let i=null!==(r=Et[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Q.warn(t.join(" "))}At(new y(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const Ot="firebase-heartbeat-store";let Mt=null;function Pt(){return Mt||(Mt=U("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Ot)}catch(t){console.warn(t)}}}).catch((t=>{throw Nt.create("idb-open",{originalErrorMessage:t.message})}))),Mt}async function Vt(t,e){try{const n=(await Pt()).transaction(Ot,"readwrite"),r=n.objectStore(Ot);await r.put(e,Ft(t)),await n.done}catch(t){if(t instanceof l)Q.warn(t.message);else{const e=Nt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});Q.warn(e.message)}}}function Ft(t){return`${t.name}!${t.options.appId}`}class Ut{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new jt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Bt();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(t){Q.warn(t)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Bt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),qt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),qt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Q.warn(t),""}}}function Bt(){return(new Date).toISOString().substring(0,10)}class jt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Pt()).transaction(Ot),n=await e.objectStore(Ot).get(Ft(t));return await e.done,n}catch(t){if(t instanceof l)Q.warn(t.message);else{const e=Nt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Q.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function qt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}At(new y("platform-logger",(t=>new K(t)),"PRIVATE")),At(new y("heartbeat",(t=>new Ut(t)),"PRIVATE")),Lt(G,H,""),Lt(G,H,"esm2017"),Lt("fire-js",""),Lt("firebase","11.0.1","app");const $t="@firebase/installations",zt="0.6.10",Kt=`w:${zt}`,Gt="FIS_v2",Ht=new h("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Qt(t){return t instanceof l&&t.code.includes("request-failed")}function Wt({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function Xt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Yt(t,e){const n=(await e.json()).error;return Ht.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Jt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Zt(t){const e=await t();return e.status>=500&&e.status<600?t():e}function te(t){return new Promise((e=>{setTimeout(e,t)}))}const ee=/^[cdef][\w-]{21}$/;function ne(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return ee.test(e)?e:""}catch(t){return""}}function re(t){return`${t.appName}!${t.appId}`}const ie=new Map;function se(t,e){const n=re(t);oe(n,e),function(t,e){const n=(!ae&&"BroadcastChannel"in self&&(ae=new BroadcastChannel("[Firebase] FID Change"),ae.onmessage=t=>{oe(t.data.key,t.data.fid)}),ae);n&&n.postMessage({key:t,fid:e}),0===ie.size&&ae&&(ae.close(),ae=null)}(n,e)}function oe(t,e){const n=ie.get(t);if(n)for(const t of n)t(e)}let ae=null;const ce="firebase-installations-store";let ue=null;function le(){return ue||(ue=U("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(ce)}})),ue}async function he(t,e){const n=re(t),r=(await le()).transaction(ce,"readwrite"),i=r.objectStore(ce),s=await i.get(n);return await i.put(e,n),await r.done,s&&s.fid===e.fid||se(t,e.fid),e}async function de(t){const e=re(t),n=(await le()).transaction(ce,"readwrite");await n.objectStore(ce).delete(e),await n.done}async function fe(t,e){const n=re(t),r=(await le()).transaction(ce,"readwrite"),i=r.objectStore(ce),s=await i.get(n),o=e(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||se(t,o.fid),o}async function pe(t){let e;const n=await fe(t.appConfig,(n=>{const r=function(t){return ye(t||{fid:ne(),registrationStatus:0})}(n),i=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Ht.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=Wt(t),i=Jt(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={fid:n,authVersion:Gt,appId:t.appId,sdkVersion:Kt},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Zt((()=>fetch(r,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Xt(t.authToken)}}throw await Yt("Create Installation",c)}(t,e);return he(t.appConfig,n)}catch(n){throw Qt(n)&&409===n.customData.serverCode?await de(t.appConfig):await he(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ge(t)}:{installationEntry:e}}(t,r);return e=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ge(t){let e=await me(t.appConfig);for(;1===e.registrationStatus;)await te(100),e=await me(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await pe(t);return n||e}return e}function me(t){return fe(t,(t=>{if(!t)throw Ht.create("installation-not-found");return ye(t)}))}function ye(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function ve({appConfig:t,heartbeatServiceProvider:e},n){const r=function(t,{fid:e}){return`${Wt(t)}/${e}/authTokens:generate`}(t,n),i=function(t,{refreshToken:e}){const n=Jt(t);return n.append("Authorization",function(t){return`${Gt} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={installation:{sdkVersion:Kt,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Zt((()=>fetch(r,a)));if(c.ok)return Xt(await c.json());throw await Yt("Generate Auth Token",c)}async function we(t,e=!1){let n;const r=await fe(t.appConfig,(r=>{if(!_e(r))throw Ht.create("not-registered");const i=r.authToken;if(!e&&(2===(s=i).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(t,e){let n=await be(t.appConfig);for(;1===n.authToken.requestStatus;)await te(100),n=await be(t.appConfig);const r=n.authToken;return 0===r.requestStatus?we(t,e):r}(t,e),r;{if(!navigator.onLine)throw Ht.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(r);return n=async function(t,e){try{const n=await ve(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await he(t.appConfig,r),n}catch(n){if(!Qt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await he(t.appConfig,n)}else await de(t.appConfig);throw n}}(t,e),e}}));return n?await n:r.authToken}function be(t){return fe(t,(t=>{if(!_e(t))throw Ht.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function _e(t){return void 0!==t&&2===t.registrationStatus}function Ee(t){return Ht.create("missing-app-config-values",{valueName:t})}const Te="installations";At(new y(Te,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Ee("App Configuration");if(!t.name)throw Ee("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Ee(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:Dt(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),At(new y("installations-internal",(t=>{const e=Dt(t.getProvider("app").getImmediate(),Te).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:r}=await pe(e);return r?r.catch(console.error):we(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await pe(t);e&&await e}(n),(await we(n,e)).token}(e,t)}}),"PRIVATE")),Lt($t,zt),Lt($t,zt,"esm2017");const Ie="analytics",Se="https://www.googletagmanager.com/gtag/js",Ce=new A("@firebase/analytics"),Ae=new h("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function De(t){if(!t.startsWith(Se)){const e=Ae.create("invalid-gtag-resource",{gtagURL:t});return Ce.warn(e.message),""}return t}function Ne(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const ke=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function xe(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Re(t,e=ke,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw Ae.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Ae.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Oe;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),Le({appId:r,apiKey:i,measurementId:s},o,a,e)}async function Le(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=ke){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener((()=>{clearTimeout(s),r(Ae.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(r,e)}catch(t){if(a)return Ce.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:r}=t,i={method:"GET",headers:xe(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Ae.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return i.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof l&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(i.deleteThrottleMetadata(o),a)return Ce.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?g(n,i.intervalMillis,30):g(n,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,h),Ce.debug(`Calling attemptFetch again in ${u} millis`),Le(t,h,r,i)}}class Oe{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Me,Pe;async function Ve(t,e,n,r,i,s,o){var a;const l=Re(t);l.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Ce.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Ce.error(t))),e.push(l);const h=async function(){if(!c())return Ce.warn(Ae.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return Ce.warn(Ae.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?r.getId():void 0)),[d,f]=await Promise.all([l,h]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Se)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:De}),r=document.createElement("script"),i=`${Se}?l=${t}&id=${e}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,d.measurementId),Pe&&(i("consent","default",Pe),Pe=void 0),i("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),i("config",d.measurementId,p),Me&&(i("set",Me),Me=void 0),d.measurementId}class Fe{constructor(t){this.app=t}_delete(){return delete Ue[this.app.options.appId],Promise.resolve()}}let Ue={},Be=[];const je={};let qe,$e,ze="dataLayer",Ke=!1;function Ge(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Ae.create("invalid-analytics-context",{errorInfo:e});Ce.warn(n.message)}}();const r=t.options.appId;if(!r)throw Ae.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Ae.create("no-api-key");Ce.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ue[r])throw Ae.create("already-exists",{id:r});if(!Ke){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(ze);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,r,i){let s=function(...t){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(t,e,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let t=i.send_to;Array.isArray(t)||(t=[t]);const r=await Ne(n);for(const n of t){const t=r.find((t=>t.measurementId===n)),i=t&&e[t.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(t){Ce.error(t)}}(t,e,n,r,i)}else if("config"===i){const[i,o]=s;await async function(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const t=(await Ne(n)).find((t=>t.measurementId===i));t&&await e[t.appId]}}catch(t){Ce.error(t)}t("config",i,s)}(t,e,n,r,i,o)}else if("consent"===i){const[e,n]=s;t("consent",e,n)}else if("get"===i){const[e,n,r]=s;t("get",e,n,r)}else if("set"===i){const[e]=s;t("set",e)}else t(i,...s)}catch(t){Ce.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}(Ue,Be,je,ze,"gtag");$e=t,qe=e,Ke=!0}return Ue[r]=Ve(t,Be,je,e,qe,ze,n),new Fe(t)}const He="@firebase/analytics",Qe="0.10.9";At(new y(Ie,((t,{options:e})=>Ge(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),At(new y("analytics-internal",(function(t){try{const e=t.getProvider(Ie).getImmediate();return{logEvent:(t,n,r)=>function(t,e,n,r){t=m(t),async function(t,e,n,r,i){if(i&&i.global)t("event",n,r);else{const i=await e;t("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}($e,Ue[t.app.options.appId],e,n,r).catch((t=>Ce.error(t)))}(e,t,n,r)}}catch(t){throw Ae.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Lt(He,Qe),Lt(He,Qe,"esm2017");var We,Xe,Ye="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Je={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function r(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,(function(){this.blockSize=-1})),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,i=this.B,s=this.h,o=0;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var i={};function s(t){return-128<=t&&128>t?function(t){var e=i;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new r([0|t],0>t?-1:0)}(t)}(t):new r([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new r(e,0)}var a=s(0),c=s(1),u=s(16777216);function l(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function h(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(l(e))throw Error("division by zero");if(l(t))return new g(a,a);if(h(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(h(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(30<t.g.length){if(h(t)||h(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;0>=r.l(t);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var u=s.add(r);0>=u.l(t)&&(i=i.add(n),s=u),r=v(r,1),n=v(n,1)}return e=f(t,i.j(e)),new g(i,e)}for(i=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(s=o(n)).j(e);h(u)||0<u.l(t);)u=(s=o(n-=r)).j(e);l(s)&&(s=c),i=i.add(s),t=f(t,u)}return new g(i,t)}function y(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new r(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],o=0;o<i;o++)s[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new r(s,t.h)}(t=r.prototype).m=function(){if(h(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(l(this))return"0";if(h(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,r="";;){var i=m(n,e).g,s=((0<(n=f(n,i.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(l(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return h(t=f(this,t))?-1:l(t)?0:1},t.abs=function(){return h(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var o=i+(65535&this.i(s))+(65535&t.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(t.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(l(this)||l(t))return a;if(h(this))return h(t)?d(this).j(d(t)):d(d(this).j(t));if(h(t))return d(this.j(d(t)));if(0>this.l(u)&&0>t.l(u))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),g=t.i(s)>>>16,m=65535&t.i(s);n[2*i+2*s]+=f*m,p(n,2*i+2*s),n[2*i+2*s+1]+=c*m,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*g,p(n,2*i+2*s+1),n[2*i+2*s+2]+=c*g,p(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new r(n,0)},t.A=function(t){return m(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new r(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new r(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,Xe=Je.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<e.length;s+=8){var c=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},We=Je.Integer=r}).apply(void 0!==Ye?Ye:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Ze,tn,en,nn,rn,sn,on,an,cn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},un={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof cn&&cn];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(0,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t,e){return e}))}}));var r=r||{},i=this||self;function s(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function h(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(s(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function p(t){return/^[\s\xa0]*$/.test(t)}function g(){var t=i.navigator;return t&&(t=t.userAgent)?t:""}function m(t){return m[" "](t),t}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function w(t){const e={};for(const n in t)e[n]=t[n];return e}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<b.length;e++)n=b[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function E(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function T(t){i.setTimeout((()=>{throw t}),0)}function I(){var t=N;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var S=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new C),(t=>t.reset()));class C{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let A,D=!1,N=new class{constructor(){this.h=this.g=null}add(t,e){const n=S.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},k=()=>{const t=i.Promise.resolve(void 0);A=()=>{t.then(x)}};var x=()=>{for(var t;t=I();){try{t.h.call(t.g)}catch(t){T(t)}var e=S;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}D=!1};function R(){this.s=this.s,this.C=this.C}function L(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},L.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(t){}return t}();function M(t,e){if(L.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{m(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:P[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&M.aa.h.call(this)}}h(M,L);var P={2:"touch",3:"pen",4:"mouse"};M.prototype.h=function(){M.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var V="closure_listenable_"+(1e6*Math.random()|0),F=0;function U(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function B(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function j(t){this.src=t,this.g={},this.h=0}function q(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(B(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}j.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=$(t,e,r,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new U(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var z="closure_lm_"+(1e6*Math.random()|0),K={};function G(t,e,n,r,i){if(r&&r.once)return Q(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)G(t,e[s],n,r,i);return null}return n=et(n),t&&t[V]?t.K(e,n,o(r)?!!r.capture:!!r,i):H(t,e,n,!1,r,i)}function H(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(t);if(c||(t[z]=c=new j(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){const t=J;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)O||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Y(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Q(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Q(t,e[s],n,r,i);return null}return n=et(n),t&&t[V]?t.L(e,n,o(r)?!!r.capture:!!r,i):H(t,e,n,!0,r,i)}function W(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)W(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=et(n),t&&t[V]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=$(s=t.g[e],n,r,i))&&(B(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$(e,n,r,i)),(n=-1<t?e[t]:null)&&X(n))}function X(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[V])q(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Y(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Z(e))?(q(n,t),0==n.h&&(n.src=null,e[z]=null)):B(t)}}}function Y(t){return t in K?K[t]:K[t]="on"+t}function J(t,e){if(t.da)t=!0;else{e=new M(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&X(t),t=n.call(r,e)}return t}function Z(t){return(t=t[z])instanceof j?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){R.call(this),this.i=new j(this),this.M=this,this.F=null}function rt(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new L(e,t);else if(e instanceof L)e.target=e.target||t;else{var i=e;_(e=new L(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=it(o,r,!0,e)&&i}if(i=it(o=e.g=t,r,!0,e)&&i,i=it(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=it(o=e.g=n[s],r,!1,e)&&i}function it(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&q(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function st(t,e,n){if("function"==typeof t)n&&(t=u(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=u(t.handleEvent,t)}return 2147483647<Number(e)?-1:i.setTimeout(t,e||0)}function ot(t){t.g=st((()=>{t.g=null,t.i&&(t.i=!1,ot(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}h(nt,R),nt.prototype[V]=!0,nt.prototype.removeEventListener=function(t,e,n,r){W(this,t,e,n,r)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)B(n[r]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},nt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class at extends R{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(t){R.call(this),this.h=t,this.g={}}h(ct,R);var ut=[];function lt(t){v(t.g,(function(t,e){this.g.hasOwnProperty(e)&&X(t)}),t),t.g={}}ct.prototype.N=function(){ct.aa.N.call(this),lt(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ht=i.JSON.stringify,dt=i.JSON.parse,ft=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function pt(){}function gt(t){return t.h||(t.h=t.i())}function mt(){}pt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){L.call(this,"d")}function wt(){L.call(this,"c")}h(vt,L),h(wt,L);var bt={},_t=null;function Et(){return _t=_t||new nt}function Tt(t){L.call(this,bt.La,t)}function It(t){const e=Et();rt(e,new Tt(e))}function St(t,e){L.call(this,bt.STAT_EVENT,t),this.stat=e}function Ct(t){const e=Et();rt(e,new St(e,t))}function At(t,e){L.call(this,bt.Ma,t),this.size=e}function Dt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){t()}),e)}function Nt(){this.g=!0}function kt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return ht(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}bt.La="serverreachability",h(Tt,L),bt.STAT_EVENT="statevent",h(St,L),bt.Ma="timingevent",h(At,L),Nt.prototype.xa=function(){this.g=!1},Nt.prototype.info=function(){};var xt,Rt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Lt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Ot(){}function Mt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pt}function Pt(){this.i=null,this.g="",this.h=!1}h(Ot,pt),Ot.prototype.g=function(){return new XMLHttpRequest},Ot.prototype.i=function(){return{}},xt=new Ot;var Vt={},Ft={};function Ut(t,e,n){t.L=1,t.v=he(oe(e)),t.m=n,t.P=!0,Bt(t,null)}function Bt(t,e){t.F=Date.now(),$t(t),t.A=oe(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),Se(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Pt,t.g=Tn(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(u(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var i="readystatechange";Array.isArray(i)||(i&&(ut[0]=i.toString()),i=ut);for(var s=0;s<i.length;s++){var o=G(n,i[s],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?w(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),It(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.u,t.A,t.l,t.R,t.m)}function jt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function qt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ft:(n=Number(e.substring(n,r)),isNaN(n)?Vt:(r+=1)+n>e.length?Ft:(e=e.slice(r,r+n),t.C=r+n,e))}function $t(t){t.S=Date.now()+t.I,zt(t,t.I)}function zt(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Dt(u(t.ba,t),e)}function Kt(t){t.B&&(i.clearTimeout(t.B),t.B=null)}function Gt(t){0==t.j.G||t.J||vn(t.j,t)}function Ht(t){Kt(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,lt(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function Qt(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||Zt(n.h,t)))if(!t.K&&Zt(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;yn(n),Xe(n)}pn(n),Ct(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Dt(u(n.Za,n),6e3));if(1>=Jt(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else bn(n,11)}else if((t.K||n.g==t)&&yn(n),!p(e))for(i=n.Da.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const e=u[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(te(s,s.h),s.h=null))}if(r.D){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,le(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=En(r,r.J?r.ia:null,r.W),o.K){ee(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(Kt(a),$t(a)),r.g=o}else fn(r);0<n.i.length&&Je(n)}else"stop"!=u[0]&&"close"!=u[0]||bn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?bn(n,7):We(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}It()}catch(t){}}Mt.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==Ke(t)?e.j():this.Y(t)},Mt.prototype.Y=function(t){try{if(t==this.g)t:{const d=Ke(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Ge(this.g)))){this.J||4!=d||7==e||It(),Kt(this);var n=this.g.Z();this.X=n;e:if(jt(this)){var r=Ge(this.g);t="";var s=r.length,o=4==Ke(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ht(this),Gt(this);var a="";break e}this.h.i=new i.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==s-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break e}}l=null}if(!(n=l)){this.o=!1,this.s=3,Ct(12),Ht(this),Gt(this);break t}kt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qt(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=qt(this,a),t==Ft){4==d&&(this.s=4,Ct(14),n=!1),kt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Vt){this.s=4,Ct(15),kt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}kt(this.i,this.l,t,null),Qt(this,t)}if(jt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ct(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),gn(h),h.M=!0,Ct(11))}}else kt(this.i,this.l,a,"[Invalid Chunked Response]"),Ht(this),Gt(this)}else kt(this.i,this.l,a,null),Qt(this,a);4==d&&Ht(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,$t(this)))}else(function(t){const e={};t=(t.g&&2<=Ke(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(p(t[r]))continue;var n=E(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ct(12)):(this.s=0,Ct(13)),Ht(this),Gt(this)}}}catch(t){}},Mt.prototype.cancel=function(){this.J=!0,Ht(this)},Mt.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.A),2!=this.L&&(It(),Ct(17)),Ht(this),this.s=2,Gt(this)):zt(this,this.S-t)};var Wt=class{constructor(t,e){this.g=t,this.map=e}};function Xt(t){this.l=t||10,t=i.PerformanceNavigationTiming?0<(t=i.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Yt(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Jt(t){return t.h?1:t.g?t.g.size:0}function Zt(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function te(t,e){t.g?t.g.add(e):t.h=e}function ee(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ne(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function re(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(s(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(s(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(s(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}Xt.prototype.cancel=function(){if(this.i=ne(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ie=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function se(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof se){this.h=t.h,ae(this,t.j),this.o=t.o,this.g=t.g,ce(this,t.s),this.l=t.l;var e=t.i,n=new _e;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),ue(this,n),this.m=t.m}else t&&(e=String(t).match(ie))?(this.h=!1,ae(this,e[1]||"",!0),this.o=de(e[2]||""),this.g=de(e[3]||"",!0),ce(this,e[4]),this.l=de(e[5]||"",!0),ue(this,e[6]||"",!0),this.m=de(e[7]||"")):(this.h=!1,this.i=new _e(null,this.h))}function oe(t){return new se(t)}function ae(t,e,n){t.j=n?de(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ce(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function ue(t,e,n){e instanceof _e?(t.i=e,function(t,e){e&&!t.j&&(Ee(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Te(this,e),Se(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=fe(e,we)),t.i=new _e(e,t.h))}function le(t,e,n){t.i.set(e,n)}function he(t){return le(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function de(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function fe(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,pe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function pe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}se.prototype.toString=function(){var t=[],e=this.j;e&&t.push(fe(e,me,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(fe(e,me,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(fe(n,"/"==n.charAt(0)?ve:ye,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",fe(n,be)),t.join("")};var ge,me=/[#\/\?@]/g,ye=/[#\?:]/g,ve=/[#\?]/g,we=/[#\?@]/g,be=/#/g;function _e(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ee(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Te(t,e){Ee(t),e=Ce(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ie(t,e){return Ee(t),e=Ce(t,e),t.g.has(e)}function Se(t,e,n){Te(t,e),0<n.length&&(t.i=null,t.g.set(Ce(t,e),d(n)),t.h+=n.length)}function Ce(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ae(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(t){}}function De(){this.g=new ft}function Ne(t,e,n){const r=n||"";try{re(t,(function(t,n){let i=t;o(t)&&(i=ht(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function ke(t){this.l=t.Ub||null,this.j=t.eb||!1}function xe(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Re(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function Le(t){t.readyState=4,t.l=null,t.j=null,t.v=null,Oe(t)}function Oe(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Me(t){let e="";return v(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Pe(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Me(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):le(t,e,n))}function Ve(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=_e.prototype).add=function(t,e){Ee(this),this.i=null,t=Ce(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Ee(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.na=function(){Ee(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},t.V=function(t){Ee(this);let e=[];if("string"==typeof t)Ie(this,t)&&(e=e.concat(this.g.get(Ce(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Ee(this),this.i=null,Ie(this,t=Ce(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")},h(ke,pt),ke.prototype.g=function(){return new xe(this.l,this.j)},ke.prototype.i=(ge={},function(){return ge}),h(xe,nt),(t=xe.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,Oe(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||i).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Le(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Oe(this)),this.g&&(this.readyState=3,Oe(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Re(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Le(this):Oe(this),3==this.readyState&&Re(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,Le(this))},t.Qa=function(t){this.g&&(this.response=t,Le(this))},t.ga=function(){this.g&&Le(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(xe.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),h(Ve,nt);var Fe=/^https?$/i,Ue=["POST","PUT"];function Be(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,je(t),$e(t)}function je(t){t.A||(t.A=!0,rt(t,"complete"),rt(t,"error"))}function qe(t){if(t.h&&void 0!==r&&(!t.v[1]||4!=Ke(t)||2!=t.Z()))if(t.u&&4==Ke(t))st(t.Ea,0,t);else if(rt(t,"readystatechange"),4==Ke(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===r){var o=String(t.D).match(ie)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Fe.test(o?o.toLowerCase():"")}n=s}if(n)rt(t,"complete"),rt(t,"success");else{t.m=6;try{var a=2<Ke(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",je(t)}}finally{$e(t)}}}function $e(t,e){if(t.g){ze(t);const n=t.g,r=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function ze(t){t.I&&(i.clearTimeout(t.I),t.I=null)}function Ke(t){return t.g?t.g.readyState:0}function Ge(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function He(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qe(t){this.Aa=0,this.i=[],this.j=new Nt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=He("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=He("baseRetryDelayMs",5e3,t),this.cb=He("retryDelaySeedMs",1e4,t),this.Wa=He("forwardChannelMaxRetries",2,t),this.wa=He("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new Xt(t&&t.concurrentRequestLimit),this.Da=new De,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function We(t){if(Ye(t),3==t.G){var e=t.U++,n=oe(t.I);if(le(n,"SID",t.K),le(n,"RID",e),le(n,"TYPE","terminate"),hn(t,n),(e=new Mt(t,t.j,e)).L=2,e.v=he(oe(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&i.Image&&((new Image).src=e.v,n=!0),n||(e.g=Tn(e.j,null),e.g.ea(e.v)),e.F=Date.now(),$t(e)}_n(t)}function Xe(t){t.g&&(gn(t),t.g.cancel(),t.g=null)}function Ye(t){Xe(t),t.u&&(i.clearTimeout(t.u),t.u=null),yn(t),t.h.cancel(),t.s&&("number"==typeof t.s&&i.clearTimeout(t.s),t.s=null)}function Je(t){if(!Yt(t.h)&&!t.s){t.s=!0;var e=t.Ga;A||k(),D||(A(),D=!0),N.add(e,t),t.B=0}}function ln(t,e){var n;n=e?e.l:t.U++;const r=oe(t.I);le(r,"SID",t.K),le(r,"RID",n),le(r,"AID",t.T),hn(t,r),t.m&&t.o&&Pe(r,t.m,t.o),n=new Mt(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=dn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),te(t.h,n),Ut(n,r,e)}function hn(t,e){t.H&&v(t.H,(function(t,n){le(e,n,t)})),t.l&&re({},(function(t,n){le(e,n,t)}))}function dn(t,e,n){n=Math.min(t.i.length,n);var r=t.l?u(t.l.Na,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{Ne(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function fn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;A||k(),D||(A(),D=!0),N.add(e,t),t.v=0}}function pn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=Dt(u(t.Fa,t),wn(t,t.v)),t.v++,0))}function gn(t){null!=t.A&&(i.clearTimeout(t.A),t.A=null)}function mn(t){t.g=new Mt(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=oe(t.qa);le(e,"RID","rpc"),le(e,"SID",t.K),le(e,"AID",t.T),le(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&le(e,"TO",t.ja),le(e,"TYPE","xmlhttp"),hn(t,e),t.m&&t.o&&Pe(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=he(oe(e)),n.m=null,n.P=!0,Bt(n,t)}function yn(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function vn(t,e){var n=null;if(t.g==e){yn(t),gn(t),t.g=null;var r=2}else{if(!Zt(t.h,e))return;n=e.D,ee(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var i=t.B;rt(r=Et(),new At(r,n)),Je(t)}else fn(t);else if(3==(i=e.s)||0==i&&0<e.X||!(1==r&&function(t,e){return!(Jt(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=Dt(u(t.Ga,t,e),wn(t,t.B)),t.B++,0)))}(t,e)||2==r&&pn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:bn(t,5);break;case 4:bn(t,10);break;case 3:bn(t,6);break;default:bn(t,2)}}function wn(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function bn(t,e){if(t.j.info("Error code "+e),2==e){var n=u(t.fb,t),r=t.Xa;const e=!r;r=new se(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ae(r,"https"),he(r),e?function(t,e){const n=new Nt;if(i.Image){const r=new Image;r.onload=l(Ae,n,"TestLoadImage: loaded",!0,e,r),r.onerror=l(Ae,n,"TestLoadImage: error",!1,e,r),r.onabort=l(Ae,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=l(Ae,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new Nt;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ae(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?Ae(0,0,!0,e):Ae(0,0,!1,e)})).catch((()=>{clearTimeout(r),Ae(0,0,!1,e)}))}(r.toString(),n)}else Ct(2);t.G=0,t.l&&t.l.sa(e),_n(t),Ye(t)}function _n(t){if(t.G=0,t.ka=[],t.l){const e=ne(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function En(t,e,n){var r=n instanceof se?oe(n):new se(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ce(r,r.s);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var o=new se(null);r&&ae(o,r),e&&(o.g=e),s&&ce(o,s),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&le(r,n,e),le(r,"VER",t.la),hn(t,r),r}function Tn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Ve(new ke({eb:n})):new Ve(t.pa)).Ha(t.J),e}function In(){}function Sn(){}function Cn(t,e){nt.call(this),this.g=new Qe(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!p(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!p(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nn(this)}function An(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Dn(){wt.call(this),this.status=1}function Nn(t){this.g=t}(t=Ve.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xt.g(),this.v=this.o?gt(this.o):gt(xt),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Be(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=i.FormData&&t instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ue,e,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ze(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Be(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,rt(this,"complete"),rt(this,"abort"),$e(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$e(this,!0)),Ve.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?qe(this):this.bb())},t.bb=function(){qe(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<Ke(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Qe.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){Ct(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=En(this,null,this.W),Je(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Mt(this,this.j,t);let s=this.o;if(this.S&&(s?(s=w(s),_(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=dn(this,i,e),le(n=oe(this.I),"RID",t),le(n,"CVER",22),this.D&&le(n,"X-HTTP-Session-Id",this.D),hn(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Me(s)))+"&"+e:this.m&&Pe(n,this.m,s)),te(this.h,i),this.Ua&&le(n,"TYPE","init"),this.P?(le(n,"$req",e),le(n,"SID","null"),i.T=!0,Ut(i,n,null)):Ut(i,n,e),this.G=2}}else 3==this.G&&(t?ln(this,t):0==this.i.length||Yt(this.h)||ln(this))},t.Fa=function(){if(this.u=null,mn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=Dt(u(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ct(10),Xe(this),mn(this))},t.Za=function(){null!=this.C&&(this.C=null,Xe(this),pn(this),Ct(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),Ct(2)):(this.j.info("Failed to ping google.com"),Ct(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=In.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},Sn.prototype.g=function(t,e){return new Cn(t,e)},h(Cn,nt),Cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cn.prototype.close=function(){We(this.g)},Cn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=ht(t),t=n);e.i.push(new Wt(e.Ya++,t)),3==e.G&&Je(e)},Cn.prototype.N=function(){this.g.l=null,delete this.j,We(this.g),delete this.g,Cn.aa.N.call(this)},h(An,vt),h(Dn,wt),h(Nn,In),Nn.prototype.ua=function(){rt(this.g,"a")},Nn.prototype.ta=function(t){rt(this.g,new An(t))},Nn.prototype.sa=function(t){rt(this.g,new Dn)},Nn.prototype.ra=function(){rt(this.g,"b")},Sn.prototype.createWebChannel=Sn.prototype.g,Cn.prototype.send=Cn.prototype.o,Cn.prototype.open=Cn.prototype.m,Cn.prototype.close=Cn.prototype.close,an=un.createWebChannelTransport=function(){return new Sn},on=un.getStatEventTarget=function(){return Et()},sn=un.Event=bt,rn=un.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Rt.NO_ERROR=0,Rt.TIMEOUT=8,Rt.HTTP_ERROR=6,nn=un.ErrorCode=Rt,Lt.COMPLETE="complete",en=un.EventType=Lt,mt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,tn=un.WebChannel=mt,un.FetchXmlHttpFactory=ke,Ve.prototype.listenOnce=Ve.prototype.L,Ve.prototype.getLastError=Ve.prototype.Ka,Ve.prototype.getLastErrorCode=Ve.prototype.Ba,Ve.prototype.getStatus=Ve.prototype.Z,Ve.prototype.getResponseJson=Ve.prototype.Oa,Ve.prototype.getResponseText=Ve.prototype.oa,Ve.prototype.send=Ve.prototype.ea,Ve.prototype.setWithCredentials=Ve.prototype.Ha,Ze=un.XhrIo=Ve}).apply(void 0!==cn?cn:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ln="@firebase/firestore";class hn{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}hn.UNAUTHENTICATED=new hn(null),hn.GOOGLE_CREDENTIALS=new hn("google-credentials-uid"),hn.FIRST_PARTY=new hn("first-party-uid"),hn.MOCK_USER=new hn("mock-user");let dn="11.0.0";const fn=new A("@firebase/firestore");function pn(){return fn.logLevel}function gn(t,...e){if(fn.logLevel<=E.DEBUG){const n=e.map(vn);fn.debug(`Firestore (${dn}): ${t}`,...n)}}function mn(t,...e){if(fn.logLevel<=E.ERROR){const n=e.map(vn);fn.error(`Firestore (${dn}): ${t}`,...n)}}function yn(t,...e){if(fn.logLevel<=E.WARN){const n=e.map(vn);fn.warn(`Firestore (${dn}): ${t}`,...n)}}function vn(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function wn(t="Unexpected state"){const e=`FIRESTORE (${dn}) INTERNAL ASSERTION FAILED: `+t;throw mn(e),new Error(e)}function bn(t,e){t||wn()}function _n(t,e){return t}const En={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Tn extends l{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class In{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Sn{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Cn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(hn.UNAUTHENTICATED)))}shutdown(){}}class An{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Dn{constructor(t){this.t=t,this.currentUser=hn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){bn(void 0===this.o);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new In;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new In,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{gn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(gn("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new In)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(gn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(bn("string"==typeof e.accessToken),new Sn(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return bn(null===t||"string"==typeof t),new hn(t)}}class Nn{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=hn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class kn{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Nn(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(hn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class xn{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Rn{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){bn(void 0===this.o);const n=t=>{null!=t.error&&gn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,gn("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{gn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):gn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(bn("string"==typeof t.token),this.R=t.token,new xn(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ln(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class On{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ln(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Mn(t,e){return t<e?-1:t>e?1:0}function Pn(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class Vn{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Tn(En.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Tn(En.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Tn(En.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Tn(En.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Vn.fromMillis(Date.now())}static fromDate(t){return Vn.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Vn(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Mn(this.nanoseconds,t.nanoseconds):Mn(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Fn{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Fn(t)}static min(){return new Fn(new Vn(0,0))}static max(){return new Fn(new Vn(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Un{constructor(t,e,n){void 0===e?e=0:e>t.length&&wn(),void 0===n?n=t.length-e:n>t.length-e&&wn(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Un.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Un?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Bn extends Un{construct(t,e,n){return new Bn(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Tn(En.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Bn(e)}static emptyPath(){return new Bn([])}}const jn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qn extends Un{construct(t,e,n){return new qn(t,e,n)}static isValidIdentifier(t){return jn.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qn.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new qn(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Tn(En.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Tn(En.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Tn(En.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Tn(En.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new qn(e)}static emptyPath(){return new qn([])}}class $n{constructor(t){this.path=t}static fromPath(t){return new $n(Bn.fromString(t))}static fromName(t){return new $n(Bn.fromString(t).popFirst(5))}static empty(){return new $n(Bn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Bn.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Bn.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new $n(new Bn(t.slice()))}}function zn(t){return new Kn(t.readTime,t.key,-1)}class Kn{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Kn(Fn.min(),$n.empty(),-1)}static max(){return new Kn(Fn.max(),$n.empty(),-1)}}function Gn(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=$n.comparator(t.documentKey,e.documentKey),0!==n?n:Mn(t.largestBatchId,e.largestBatchId))}class Hn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Qn(t){if(t.code!==En.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;gn("LocalStore","Unexpectedly lost primary lease")}class Wn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&wn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Wn(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Wn?e:Wn.resolve(e)}catch(t){return Wn.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Wn.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Wn.reject(e)}static resolve(t){return new Wn(((e,n)=>{e(t)}))}static reject(t){return new Wn(((e,n)=>{n(t)}))}static waitFor(t){return new Wn(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=Wn.resolve(!1);for(const n of t)e=e.next((t=>t?Wn.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new Wn(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new Wn(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function Xn(t){return"IndexedDbTransactionError"===t.name}class Yn{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function Jn(t){return null==t}function Zn(t){return 0===t&&1/t==-1/0}function tr(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function er(t){return t+""}Yn.oe=-1;function nr(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function rr(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ir(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class sr{constructor(t,e){this.comparator=t,this.root=e||ar.EMPTY}insert(t,e){return new sr(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ar.BLACK,null,null))}remove(t){return new sr(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ar.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new or(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new or(this.root,t,this.comparator,!1)}getReverseIterator(){return new or(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new or(this.root,t,this.comparator,!0)}}class or{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ar{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ar.RED,this.left=null!=r?r:ar.EMPTY,this.right=null!=i?i:ar.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new ar(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ar.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return ar.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ar.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ar.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw wn();if(this.right.isRed())throw wn();const t=this.left.check();if(t!==this.right.check())throw wn();return t+(this.isRed()?0:1)}}ar.EMPTY=null,ar.RED=!0,ar.BLACK=!1,ar.EMPTY=new class{constructor(){this.size=0}get key(){throw wn()}get value(){throw wn()}get color(){throw wn()}get left(){throw wn()}get right(){throw wn()}copy(t,e,n,r,i){return this}insert(t,e,n){return new ar(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class cr{constructor(t){this.comparator=t,this.data=new sr(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ur(this.data.getIterator())}getIteratorFrom(t){return new ur(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof cr))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new cr(this.comparator);return e.data=t,e}}class ur{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class lr{constructor(t){this.fields=t,t.sort(qn.comparator)}static empty(){return new lr([])}unionWith(t){let e=new cr(qn.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new lr(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Pn(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class hr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class dr{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new hr("Invalid base64 string: "+t):t}}(t);return new dr(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new dr(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Mn(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}dr.EMPTY_BYTE_STRING=new dr("");const fr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pr(t){if(bn(!!t),"string"==typeof t){let e=0;const n=fr.exec(t);if(bn(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:gr(t.seconds),nanos:gr(t.nanos)}}function gr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function mr(t){return"string"==typeof t?dr.fromBase64String(t):dr.fromUint8Array(t)}function yr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function vr(t){const e=t.mapValue.fields.__previous_value__;return yr(e)?vr(e):e}function wr(t){const e=pr(t.mapValue.fields.__local_write_time__.timestampValue);return new Vn(e.seconds,e.nanos)}class br{constructor(t,e,n,r,i,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class _r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new _r("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof _r&&t.projectId===this.projectId&&t.database===this.database}}const Er={fields:{__type__:{stringValue:"__max__"}}};function Tr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?yr(t)?4:Br(t)?9007199254740991:Fr(t)?10:11:wn()}function Ir(t,e){if(t===e)return!0;const n=Tr(t);if(n!==Tr(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return wr(t).isEqual(wr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=pr(t.timestampValue),r=pr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return mr(t.bytesValue).isEqual(mr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return gr(t.geoPointValue.latitude)===gr(e.geoPointValue.latitude)&&gr(t.geoPointValue.longitude)===gr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return gr(t.integerValue)===gr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=gr(t.doubleValue),r=gr(e.doubleValue);return n===r?Zn(n)===Zn(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Pn(t.arrayValue.values||[],e.arrayValue.values||[],Ir);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(nr(n)!==nr(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Ir(n[t],r[t])))return!1;return!0}(t,e);default:return wn()}}function Sr(t,e){return void 0!==(t.values||[]).find((t=>Ir(t,e)))}function Cr(t,e){if(t===e)return 0;const n=Tr(t),r=Tr(e);if(n!==r)return Mn(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Mn(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=gr(t.integerValue||t.doubleValue),r=gr(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ar(t.timestampValue,e.timestampValue);case 4:return Ar(wr(t),wr(e));case 5:return Mn(t.stringValue,e.stringValue);case 6:return function(t,e){const n=mr(t),r=mr(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Mn(n[t],r[t]);if(0!==e)return e}return Mn(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Mn(gr(t.latitude),gr(e.latitude));return 0!==n?n:Mn(gr(t.longitude),gr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Dr(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,r,i,s;const o=t.fields||{},a=e.fields||{},c=null===(n=o.value)||void 0===n?void 0:n.arrayValue,u=null===(r=a.value)||void 0===r?void 0:r.arrayValue,l=Mn((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:Dr(c,u)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Er&&e===Er)return 0;if(t===Er)return 1;if(e===Er)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=Mn(r[t],s[t]);if(0!==e)return e;const o=Cr(n[r[t]],i[s[t]]);if(0!==o)return o}return Mn(r.length,s.length)}(t.mapValue,e.mapValue);default:throw wn()}}function Ar(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Mn(t,e);const n=pr(t),r=pr(e),i=Mn(n.seconds,r.seconds);return 0!==i?i:Mn(n.nanos,r.nanos)}function Dr(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Cr(n[t],r[t]);if(e)return e}return Mn(n.length,r.length)}function Nr(t){return kr(t)}function kr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=pr(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return mr(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return $n.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=kr(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${kr(t.fields[i])}`;return n+"}"}(t.mapValue):wn()}function xr(t){switch(Tr(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=vr(t);return e?16+xr(e):16;case 5:return 2*t.stringValue.length;case 6:return mr(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce(((t,e)=>t+xr(e)),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return rr(t.fields,((t,n)=>{e+=t.length+xr(n)})),e}(t.mapValue);default:throw wn()}}function Rr(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Lr(t){return!!t&&"integerValue"in t}function Or(t){return!!t&&"arrayValue"in t}function Mr(t){return!!t&&"nullValue"in t}function Pr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Vr(t){return!!t&&"mapValue"in t}function Fr(t){var e,n;return"__vector__"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ur(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return rr(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ur(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ur(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Br(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class jr{constructor(t){this.value=t}static empty(){return new jr({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Vr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ur(e)}setAll(t){let e=qn.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Ur(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());Vr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ir(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Vr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){rr(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new jr(Ur(this.value))}}function qr(t){const e=[];return rr(t.fields,((t,n)=>{const r=new qn([t]);if(Vr(n)){const t=qr(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new lr(e)}class $r{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new $r(t,0,Fn.min(),Fn.min(),Fn.min(),jr.empty(),0)}static newFoundDocument(t,e,n,r){return new $r(t,1,e,Fn.min(),n,r,0)}static newNoDocument(t,e){return new $r(t,2,e,Fn.min(),Fn.min(),jr.empty(),0)}static newUnknownDocument(t,e){return new $r(t,3,e,Fn.min(),Fn.min(),jr.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Fn.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=jr.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=jr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof $r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new $r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zr{constructor(t,e){this.position=t,this.inclusive=e}}function Kr(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?$n.comparator($n.fromName(o.referenceValue),n.key):Cr(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Gr(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ir(t.position[n],e.position[n]))return!1;return!0}class Hr{constructor(t,e="asc"){this.field=t,this.dir=e}}function Qr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Wr{}class Xr extends Wr{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new ri(t,e,n):"array-contains"===e?new ai(t,n):"in"===e?new ci(t,n):"not-in"===e?new ui(t,n):"array-contains-any"===e?new li(t,n):new Xr(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new ii(t,n):new si(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Cr(e,this.value)):null!==e&&Tr(this.value)===Tr(e)&&this.matchesComparison(Cr(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return wn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Yr extends Wr{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new Yr(t,e)}matches(t){return Jr(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Jr(t){return"and"===t.op}function Zr(t){return function(t){for(const e of t.filters)if(e instanceof Yr)return!1;return!0}(t)&&Jr(t)}function ti(t){if(t instanceof Xr)return t.field.canonicalString()+t.op.toString()+Nr(t.value);if(Zr(t))return t.filters.map((t=>ti(t))).join(",");{const e=t.filters.map((t=>ti(t))).join(",");return`${t.op}(${e})`}}function ei(t,e){return t instanceof Xr?function(t,e){return e instanceof Xr&&t.op===e.op&&t.field.isEqual(e.field)&&Ir(t.value,e.value)}(t,e):t instanceof Yr?function(t,e){return e instanceof Yr&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&ei(n,e.filters[r])),!0)}(t,e):void wn()}function ni(t){return t instanceof Xr?function(t){return`${t.field.canonicalString()} ${t.op} ${Nr(t.value)}`}(t):t instanceof Yr?function(t){return t.op.toString()+" {"+t.getFilters().map(ni).join(" ,")+"}"}(t):"Filter"}class ri extends Xr{constructor(t,e,n){super(t,e,n),this.key=$n.fromName(n.referenceValue)}matches(t){const e=$n.comparator(t.key,this.key);return this.matchesComparison(e)}}class ii extends Xr{constructor(t,e){super(t,"in",e),this.keys=oi(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class si extends Xr{constructor(t,e){super(t,"not-in",e),this.keys=oi(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function oi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>$n.fromName(t.referenceValue)))}class ai extends Xr{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Or(e)&&Sr(e.arrayValue,this.value)}}class ci extends Xr{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Sr(this.value.arrayValue,e)}}class ui extends Xr{constructor(t,e){super(t,"not-in",e)}matches(t){if(Sr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Sr(this.value.arrayValue,e)}}class li extends Xr{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Or(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Sr(this.value.arrayValue,t)))}}class hi{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ue=null}}function di(t,e=null,n=[],r=[],i=null,s=null,o=null){return new hi(t,e,n,r,i,s,o)}function fi(t){const e=_n(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ti(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Jn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Nr(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Nr(t))).join(",")),e.ue=t}return e.ue}function pi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Qr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ei(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Gr(t.startAt,e.startAt)&&Gr(t.endAt,e.endAt)}function gi(t){return $n.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class mi{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function yi(t){return new mi(t)}function vi(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function wi(t){return null!==t.collectionGroup}function bi(t){const e=_n(t);if(null===e.ce){e.ce=[];const t=new Set;for(const n of e.explicitOrderBy)e.ce.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new cr(qn.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new Hr(r,n))})),t.has(qn.keyField().canonicalString())||e.ce.push(new Hr(qn.keyField(),n))}return e.ce}function _i(t){const e=_n(t);return e.le||(e.le=function(t,e){if("F"===t.limitType)return di(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Hr(t.field,e)}));const n=t.endAt?new zr(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new zr(t.startAt.position,t.startAt.inclusive):null;return di(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,bi(t))),e.le}function Ei(t,e){const n=t.filters.concat([e]);return new mi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Ti(t,e,n){return new mi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ii(t,e){return pi(_i(t),_i(e))&&t.limitType===e.limitType}function Si(t){return`${fi(_i(t))}|lt:${t.limitType}`}function Ci(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>ni(t))).join(", ")}]`),Jn(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Nr(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Nr(t))).join(",")),`Target(${e})`}(_i(t))}; limitType=${t.limitType})`}function Ai(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):$n.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of bi(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Kr(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,bi(t),e)||t.endAt&&!function(t,e,n){const r=Kr(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,bi(t),e))}(t,e)}function Di(t){return(e,n)=>{let r=!1;for(const i of bi(t)){const t=Ni(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Ni(t,e,n){const r=t.field.isKeyField()?$n.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Cr(r,i):wn()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return wn()}}class ki{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){rr(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return ir(this.inner)}size(){return this.innerSize}}const xi=new sr($n.comparator);function Ri(){return xi}const Li=new sr($n.comparator);function Oi(...t){let e=Li;for(const n of t)e=e.insert(n.key,n);return e}function Mi(t){let e=Li;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Pi(){return Fi()}function Vi(){return Fi()}function Fi(){return new ki((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Ui=new sr($n.comparator),Bi=new cr($n.comparator);function ji(...t){let e=Bi;for(const n of t)e=e.add(n);return e}const qi=new cr(Mn);function $i(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zn(e)?"-0":e}}function zi(t){return{integerValue:""+t}}function Ki(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Zn(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?zi(e):$i(t,e)}class Gi{constructor(){this._=void 0}}function Hi(t,e,n){return t instanceof Xi?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&yr(e)&&(e=vr(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Yi?Ji(t,e):t instanceof Zi?ts(t,e):function(t,e){const n=Wi(t,e),r=ns(n)+ns(t.Pe);return Lr(n)&&Lr(t.Pe)?zi(r):$i(t.serializer,r)}(t,e)}function Qi(t,e,n){return t instanceof Yi?Ji(t,e):t instanceof Zi?ts(t,e):n}function Wi(t,e){return t instanceof es?function(t){return Lr(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Xi extends Gi{}class Yi extends Gi{constructor(t){super(),this.elements=t}}function Ji(t,e){const n=rs(e);for(const e of t.elements)n.some((t=>Ir(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Zi extends Gi{constructor(t){super(),this.elements=t}}function ts(t,e){let n=rs(e);for(const e of t.elements)n=n.filter((t=>!Ir(t,e)));return{arrayValue:{values:n}}}class es extends Gi{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function ns(t){return gr(t.integerValue||t.doubleValue)}function rs(t){return Or(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class is{constructor(t,e){this.version=t,this.transformResults=e}}class ss{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ss}static exists(t){return new ss(void 0,t)}static updateTime(t){return new ss(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function os(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class as{}function cs(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new vs(t.key,ss.none()):new fs(t.key,t.data,ss.none());{const n=t.data,r=jr.empty();let i=new cr(qn.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new ps(t.key,r,new lr(i.toArray()),ss.none())}}function us(t,e,n){t instanceof fs?function(t,e,n){const r=t.value.clone(),i=ms(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ps?function(t,e,n){if(!os(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=ms(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(gs(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ls(t,e,n,r){return t instanceof fs?function(t,e,n,r){if(!os(t.precondition,e))return n;const i=t.value.clone(),s=ys(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof ps?function(t,e,n,r){if(!os(t.precondition,e))return n;const i=ys(t.fieldTransforms,r,e),s=e.data;return s.setAll(gs(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return os(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function hs(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=Wi(r.transform,t||null);null!=i&&(null===n&&(n=jr.empty()),n.set(r.field,i))}return n||null}function ds(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Pn(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Yi&&e instanceof Yi||t instanceof Zi&&e instanceof Zi?Pn(t.elements,e.elements,Ir):t instanceof es&&e instanceof es?Ir(t.Pe,e.Pe):t instanceof Xi&&e instanceof Xi}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class fs extends as{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ps extends as{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function gs(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function ms(t,e,n){const r=new Map;bn(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Qi(o,a,n[i]))}return r}function ys(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,Hi(t,s,e))}return r}class vs extends as{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ws extends as{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class bs{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&us(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ls(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ls(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Vi();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=cs(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Fn.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ji())}isEqual(t){return this.batchId===t.batchId&&Pn(this.mutations,t.mutations,((t,e)=>ds(t,e)))&&Pn(this.baseMutations,t.baseMutations,((t,e)=>ds(t,e)))}}class _s{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){bn(t.mutations.length===n.length);let r=Ui;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new _s(t,e,n,r)}}class Es{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ts{constructor(t,e){this.count=t,this.unchangedNames=e}}var Is,Ss;function Cs(t){if(void 0===t)return mn("GRPC error has no .code"),En.UNKNOWN;switch(t){case Is.OK:return En.OK;case Is.CANCELLED:return En.CANCELLED;case Is.UNKNOWN:return En.UNKNOWN;case Is.DEADLINE_EXCEEDED:return En.DEADLINE_EXCEEDED;case Is.RESOURCE_EXHAUSTED:return En.RESOURCE_EXHAUSTED;case Is.INTERNAL:return En.INTERNAL;case Is.UNAVAILABLE:return En.UNAVAILABLE;case Is.UNAUTHENTICATED:return En.UNAUTHENTICATED;case Is.INVALID_ARGUMENT:return En.INVALID_ARGUMENT;case Is.NOT_FOUND:return En.NOT_FOUND;case Is.ALREADY_EXISTS:return En.ALREADY_EXISTS;case Is.PERMISSION_DENIED:return En.PERMISSION_DENIED;case Is.FAILED_PRECONDITION:return En.FAILED_PRECONDITION;case Is.ABORTED:return En.ABORTED;case Is.OUT_OF_RANGE:return En.OUT_OF_RANGE;case Is.UNIMPLEMENTED:return En.UNIMPLEMENTED;case Is.DATA_LOSS:return En.DATA_LOSS;default:return wn()}}(Ss=Is||(Is={}))[Ss.OK=0]="OK",Ss[Ss.CANCELLED=1]="CANCELLED",Ss[Ss.UNKNOWN=2]="UNKNOWN",Ss[Ss.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ss[Ss.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ss[Ss.NOT_FOUND=5]="NOT_FOUND",Ss[Ss.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ss[Ss.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ss[Ss.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ss[Ss.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ss[Ss.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ss[Ss.ABORTED=10]="ABORTED",Ss[Ss.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ss[Ss.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ss[Ss.INTERNAL=13]="INTERNAL",Ss[Ss.UNAVAILABLE=14]="UNAVAILABLE",Ss[Ss.DATA_LOSS=15]="DATA_LOSS";const As=new We([4294967295,4294967295],0);function Ds(t){const e=(new TextEncoder).encode(t),n=new Xe;return n.update(e),new Uint8Array(n.digest())}function Ns(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new We([n,r],0),new We([i,s],0)]}class ks{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new xs(`Invalid padding: ${e}`);if(n<0)throw new xs(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new xs(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new xs(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=We.fromNumber(this.Ie)}Ee(t,e,n){let r=t.add(e.multiply(We.fromNumber(n)));return 1===r.compare(As)&&(r=new We([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ie)return!1;const e=Ds(t),[n,r]=Ns(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);if(!this.de(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new ks(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Ie)return;const e=Ds(t),[n,r]=Ns(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class xs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Rs{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Ls.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Rs(Fn.min(),r,new sr(Mn),Ri(),ji())}}class Ls{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Ls(n,e,ji(),ji(),ji())}}class Os{constructor(t,e,n,r){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=r}}class Ms{constructor(t,e){this.targetId=t,this.me=e}}class Ps{constructor(t,e,n=dr.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Vs{constructor(){this.fe=0,this.ge=Bs(),this.pe=dr.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=ji(),e=ji(),n=ji();return this.ge.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:wn()}})),new Ls(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=Bs()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,bn(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Fs{constructor(t){this.Le=t,this.Be=new Map,this.ke=Ri(),this.qe=Us(),this.Qe=new sr(Mn)}Ke(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,(e=>{const n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:wn()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,n)=>{this.ze(n)&&e(n)}))}He(t){const e=t.targetId,n=t.me.count,r=this.Je(e);if(r){const i=r.target;if(gi(i))if(0===n){const t=new $n(i.path);this.Ue(e,t,$r.newNoDocument(t,Fn.min()))}else bn(1===n);else{const r=this.Ye(e);if(r!==n){const n=this.Ze(t),i=n?this.Xe(n,t,r):1;if(0!==i){this.je(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,t)}}}}}Ze(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=mr(n).toUint8Array()}catch(t){if(t instanceof hr)return yn("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ks(s,r,i)}catch(t){return yn(t instanceof xs?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Ie?null:o}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.Ue(e,n,null),r++)})),r}rt(t){const e=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&gi(i.target)){const e=new $n(i.target.path);null!==this.ke.get(e)||this.it(r,e)||this.Ue(r,e,$r.newNoDocument(e,t))}n.be&&(e.set(r,n.ve()),n.Ce())}}));let n=ji();this.qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Je(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.ke.forEach(((e,n)=>n.setReadTime(t)));const r=new Rs(t,e,this.Qe,this.ke,n);return this.ke=Ri(),this.qe=Us(),this.Qe=new sr(Mn),r}$e(t,e){if(!this.ze(t))return;const n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;const r=this.Ge(t);this.it(t,e)?r.Fe(e,1):r.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){const e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new Vs,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new cr(Mn),this.qe=this.qe.insert(t,e)),e}ze(t){const e=null!==this.Je(t);return e||gn("WatchChangeAggregator","Detected inactive target",t),e}Je(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Vs),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.Ue(t,e,null)}))}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function Us(){return new sr($n.comparator)}function Bs(){return new sr($n.comparator)}const js={asc:"ASCENDING",desc:"DESCENDING"},qs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$s={and:"AND",or:"OR"};class zs{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Ks(t,e){return t.useProto3Json||Jn(e)?e:{value:e}}function Gs(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hs(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Qs(t,e){return Gs(t,e.toTimestamp())}function Ws(t){return bn(!!t),Fn.fromTimestamp(function(t){const e=pr(t);return new Vn(e.seconds,e.nanos)}(t))}function Xs(t,e){return Ys(t,e).canonicalString()}function Ys(t,e){const n=function(t){return new Bn(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Js(t){const e=Bn.fromString(t);return bn(yo(e)),e}function Zs(t,e){return Xs(t.databaseId,e.path)}function to(t,e){const n=Js(e);if(n.get(1)!==t.databaseId.projectId)throw new Tn(En.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Tn(En.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new $n(ro(n))}function eo(t,e){return Xs(t.databaseId,e)}function no(t){return new Bn(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ro(t){return bn(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function io(t,e,n){return{name:Zs(t,e),fields:n.value.mapValue.fields}}function so(t,e){return{documents:[eo(t,e.path)]}}function oo(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=eo(t,i);const s=function(t){if(0!==t.length)return go(Yr.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:fo(t.field),direction:uo(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Ks(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{_t:n,parent:i}}function ao(t){let e=function(t){const e=Js(t);return 4===e.length?Bn.emptyPath():ro(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){bn(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=co(t);return e instanceof Yr&&Zr(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Hr(po(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Jn(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new zr(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new zr(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new mi(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function co(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=po(t.unaryFilter.field);return Xr.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=po(t.unaryFilter.field);return Xr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=po(t.unaryFilter.field);return Xr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=po(t.unaryFilter.field);return Xr.create(i,"!=",{nullValue:"NULL_VALUE"});default:return wn()}}(t):void 0!==t.fieldFilter?function(t){return Xr.create(po(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return wn()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Yr.create(t.compositeFilter.filters.map((t=>co(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return wn()}}(t.compositeFilter.op))}(t):wn()}function uo(t){return js[t]}function lo(t){return qs[t]}function ho(t){return $s[t]}function fo(t){return{fieldPath:t.canonicalString()}}function po(t){return qn.fromServerFormat(t.fieldPath)}function go(t){return t instanceof Xr?function(t){if("=="===t.op){if(Pr(t.value))return{unaryFilter:{field:fo(t.field),op:"IS_NAN"}};if(Mr(t.value))return{unaryFilter:{field:fo(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Pr(t.value))return{unaryFilter:{field:fo(t.field),op:"IS_NOT_NAN"}};if(Mr(t.value))return{unaryFilter:{field:fo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fo(t.field),op:lo(t.op),value:t.value}}}(t):t instanceof Yr?function(t){const e=t.getFilters().map((t=>go(t)));return 1===e.length?e[0]:{compositeFilter:{op:ho(t.op),filters:e}}}(t):wn()}function mo(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function yo(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class vo{constructor(t,e,n,r,i=Fn.min(),s=Fn.min(),o=dr.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new vo(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new vo(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new vo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new vo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class wo{constructor(t){this.ct=t}}function bo(t){const e=ao({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ti(e,e.limit,"L"):e}class _o{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(gr(t.integerValue));else if("doubleValue"in t){const n=gr(t.doubleValue);isNaN(n)?this.dt(e,13):(this.dt(e,15),Zn(n)?e.At(0):e.At(n))}else if("timestampValue"in t){let n=t.timestampValue;this.dt(e,20),"string"==typeof n&&(n=pr(n)),e.Rt(`${n.seconds||""}`),e.At(n.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(mr(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.dt(e,45),e.At(n.latitude||0),e.At(n.longitude||0)}else"mapValue"in t?Br(t)?this.dt(e,Number.MAX_SAFE_INTEGER):Fr(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):wn()}Vt(t,e){this.dt(e,25),this.Dt(t,e)}Dt(t,e){e.Rt(t)}St(t,e){const n=t.fields||{};this.dt(e,55);for(const t of Object.keys(n))this.Vt(t,e),this.Tt(n[t],e)}wt(t,e){var n,r;const i=t.fields||{};this.dt(e,53);const s="value",o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(e,15),e.At(gr(o)),this.Vt(s,e),this.Tt(i[s],e)}bt(t,e){const n=t.values||[];this.dt(e,50);for(const t of n)this.Tt(t,e)}yt(t,e){this.dt(e,37),$n.fromName(t).path.forEach((t=>{this.dt(e,60),this.Dt(t,e)}))}dt(t,e){t.At(e)}ft(t){t.At(2)}}_o.vt=new _o;class Eo{constructor(){this.un=new To}addToCollectionParentIndex(t,e){return this.un.add(e),Wn.resolve()}getCollectionParents(t,e){return Wn.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return Wn.resolve()}deleteFieldIndex(t,e){return Wn.resolve()}deleteAllFieldIndexes(t){return Wn.resolve()}createTargetIndexes(t,e){return Wn.resolve()}getDocumentsMatchingTarget(t,e){return Wn.resolve(null)}getIndexType(t,e){return Wn.resolve(0)}getFieldIndexes(t,e){return Wn.resolve([])}getNextCollectionGroupToUpdate(t){return Wn.resolve(null)}getMinOffset(t,e){return Wn.resolve(Kn.min())}getMinOffsetFromCollectionGroup(t,e){return Wn.resolve(Kn.min())}updateCollectionGroup(t,e,n){return Wn.resolve()}updateIndexEntries(t,e){return Wn.resolve()}}class To{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new cr(Bn.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new cr(Bn.comparator)).toArray()}}new Uint8Array(0);const Io={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class So{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new So(t,So.DEFAULT_COLLECTION_PERCENTILE,So.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}So.DEFAULT_COLLECTION_PERCENTILE=10,So.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,So.DEFAULT=new So(41943040,So.DEFAULT_COLLECTION_PERCENTILE,So.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),So.DISABLED=new So(-1,0,0);class Co{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new Co(0)}static kn(){return new Co(-1)}}function Ao([t,e],[n,r]){const i=Mn(t,n);return 0===i?Mn(e,r):i}class Do{constructor(t){this.Un=t,this.buffer=new cr(Ao),this.Wn=0}Gn(){return++this.Wn}zn(t){const e=[t,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Ao(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class No{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(t){gn("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Xn(t)?gn("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Qn(t)}await this.Hn(3e5)}))}}class ko{constructor(t,e){this.Jn=t,this.params=e}calculateTargetCount(t,e){return this.Jn.Yn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Wn.resolve(Yn.oe);const n=new Do(e);return this.Jn.forEachTarget(t,(t=>n.zn(t.sequenceNumber))).next((()=>this.Jn.Zn(t,(t=>n.zn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Jn.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(gn("LruGarbageCollector","Garbage collection skipped; disabled"),Wn.resolve(Io)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(gn("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Io):this.Xn(t,e)))}getCacheSize(t){return this.Jn.getCacheSize(t)}Xn(t,e){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(gn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),pn()<=E.DEBUG&&gn("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Wn.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t}))))}}class xo{constructor(){this.changes=new ki((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,$r.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Wn.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Ro{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Lo{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&ls(n.mutation,t,lr.empty(),Vn.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ji()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ji()){const r=Pi();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=Oi();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Pi();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ji())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=Ri();const s=Fi(),o=Fi();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof ps)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),ls(o.mutation,e,o.mutation.getFieldMask(),Vn.now())):s.set(e.key,lr.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Ro(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Fi();let r=new sr(((t,e)=>t-e)),i=ji();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||lr.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||ji()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Vi();c.forEach((t=>{if(!i.has(t)){const r=cs(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Wn.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return $n.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):wi(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):Wn.resolve(Pi());let o=-1,a=i;return s.next((e=>Wn.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Wn.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,ji()))).next((t=>({batchId:o,changes:Mi(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new $n(e)).next((t=>{let e=Oi();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=Oi();return this.indexManager.getCollectionParents(t,i).next((o=>Wn.forEach(o,(o=>{const a=function(t,e){return new mi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,$r.newInvalidDocument(r)))}));let n=Oi();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&ls(s.mutation,r,lr.empty(),Vn.now()),Ai(e,r)&&(n=n.insert(t,r))})),n}))}}class Oo{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return Wn.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Ws(t.createTime)}}(e)),Wn.resolve()}getNamedQuery(t,e){return Wn.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,function(t){return{name:t.name,query:bo(t.bundledQuery),readTime:Ws(t.readTime)}}(e)),Wn.resolve()}}class Mo{constructor(){this.overlays=new sr($n.comparator),this.Ir=new Map}getOverlay(t,e){return Wn.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Pi();return Wn.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),Wn.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.Ir.delete(n)),Wn.resolve()}getOverlaysForCollection(t,e,n){const r=Pi(),i=e.length+1,s=new $n(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Wn.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new sr(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Pi(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Pi(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return Wn.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Es(e,n));let i=this.Ir.get(e);void 0===i&&(i=ji(),this.Ir.set(e,i)),this.Ir.set(e,i.add(n.key))}}class Po{constructor(){this.sessionToken=dr.EMPTY_BYTE_STRING}getSessionToken(t){return Wn.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Wn.resolve()}}class Vo{constructor(){this.Tr=new cr(Fo.Er),this.dr=new cr(Fo.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){const n=new Fo(t,e);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Vr(new Fo(t,e))}mr(t,e){t.forEach((t=>this.removeReference(t,e)))}gr(t){const e=new $n(new Bn([])),n=new Fo(e,t),r=new Fo(e,t+1),i=[];return this.dr.forEachInRange([n,r],(t=>{this.Vr(t),i.push(t.key)})),i}pr(){this.Tr.forEach((t=>this.Vr(t)))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){const e=new $n(new Bn([])),n=new Fo(e,t),r=new Fo(e,t+1);let i=ji();return this.dr.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Fo(t,0),n=this.Tr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Fo{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return $n.comparator(t.key,e.key)||Mn(t.wr,e.wr)}static Ar(t,e){return Mn(t.wr,e.wr)||$n.comparator(t.key,e.key)}}class Uo{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new cr(Fo.Er)}checkEmpty(t){return Wn.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new bs(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.br=this.br.add(new Fo(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Wn.resolve(s)}lookupMutationBatch(t,e){return Wn.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.vr(n),i=r<0?0:r;return Wn.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Wn.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(t){return Wn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Fo(e,0),r=new Fo(e,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],(t=>{const e=this.Dr(t.wr);i.push(e)})),Wn.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new cr(Mn);return e.forEach((t=>{const e=new Fo(t,0),r=new Fo(t,Number.POSITIVE_INFINITY);this.br.forEachInRange([e,r],(t=>{n=n.add(t.wr)}))})),Wn.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;$n.isDocumentKey(i)||(i=i.child(""));const s=new Fo(new $n(i),0);let o=new cr(Mn);return this.br.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.wr)),!0)}),s),Wn.resolve(this.Cr(o))}Cr(t){const e=[];return t.forEach((t=>{const n=this.Dr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){bn(0===this.Fr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return Wn.forEach(e.mutations,(r=>{const i=new Fo(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.br=n}))}On(t){}containsKey(t,e){const n=new Fo(e,0),r=this.br.firstAfterOrEqual(n);return Wn.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Wn.resolve()}Fr(t,e){return this.vr(t)}vr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Dr(t){const e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Bo{constructor(t){this.Mr=t,this.docs=new sr($n.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.Mr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Wn.resolve(n?n.document.mutableCopy():$r.newInvalidDocument(e))}getEntries(t,e){let n=Ri();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():$r.newInvalidDocument(t))})),Wn.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Ri();const s=e.path,o=new $n(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Gn(zn(o),n)<=0||(r.has(o.key)||Ai(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Wn.resolve(i)}getAllFromCollectionGroup(t,e,n,r){wn()}Or(t,e){return Wn.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new jo(this)}getSize(t){return Wn.resolve(this.size)}}class jo extends xo{constructor(t){super(),this.cr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.cr.addEntry(t,r)):this.cr.removeEntry(n)})),Wn.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}}class qo{constructor(t){this.persistence=t,this.Nr=new ki((t=>fi(t)),pi),this.lastRemoteSnapshotVersion=Fn.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Vo,this.targetCount=0,this.kr=Co.Bn()}forEachTarget(t,e){return this.Nr.forEach(((t,n)=>e(n))),Wn.resolve()}getLastRemoteSnapshotVersion(t){return Wn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Wn.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),Wn.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Lr&&(this.Lr=e),Wn.resolve()}Kn(t){this.Nr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.kr=new Co(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,Wn.resolve()}updateTargetData(t,e){return this.Kn(e),Wn.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,Wn.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Nr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Nr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Wn.waitFor(i).next((()=>r))}getTargetCount(t){return Wn.resolve(this.targetCount)}getTargetData(t,e){const n=this.Nr.get(e)||null;return Wn.resolve(n)}addMatchingKeys(t,e,n){return this.Br.Rr(e,n),Wn.resolve()}removeMatchingKeys(t,e,n){this.Br.mr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),Wn.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),Wn.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Br.yr(e);return Wn.resolve(n)}containsKey(t,e){return Wn.resolve(this.Br.containsKey(e))}}class $o{constructor(t,e){this.qr={},this.overlays={},this.Qr=new Yn(0),this.Kr=!1,this.Kr=!0,this.$r=new Po,this.referenceDelegate=t(this),this.Ur=new qo(this),this.indexManager=new Eo,this.remoteDocumentCache=function(t){return new Bo(t)}((t=>this.referenceDelegate.Wr(t))),this.serializer=new wo(e),this.Gr=new Oo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Mo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.qr[t.toKey()];return n||(n=new Uo(e,this.referenceDelegate),this.qr[t.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,n){gn("MemoryPersistence","Starting transaction:",t);const r=new zo(this.Qr.next());return this.referenceDelegate.zr(),n(r).next((t=>this.referenceDelegate.jr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Hr(t,e){return Wn.or(Object.values(this.qr).map((n=>()=>n.containsKey(t,e))))}}class zo extends Hn{constructor(t){super(),this.currentSequenceNumber=t}}class Ko{constructor(t){this.persistence=t,this.Jr=new Vo,this.Yr=null}static Zr(t){return new Ko(t)}get Xr(){if(this.Yr)return this.Yr;throw wn()}addReference(t,e,n){return this.Jr.addReference(n,e),this.Xr.delete(n.toString()),Wn.resolve()}removeReference(t,e,n){return this.Jr.removeReference(n,e),this.Xr.add(n.toString()),Wn.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),Wn.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach((t=>this.Xr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Xr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}zr(){this.Yr=new Set}jr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Wn.forEach(this.Xr,(n=>{const r=$n.fromPath(n);return this.ei(t,r).next((t=>{t||e.removeEntry(r,Fn.min())}))})).next((()=>(this.Yr=null,e.apply(t))))}updateLimboDocument(t,e){return this.ei(t,e).next((t=>{t?this.Xr.delete(e.toString()):this.Xr.add(e.toString())}))}Wr(t){return 0}ei(t,e){return Wn.or([()=>Wn.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}}class Go{constructor(t,e){this.persistence=t,this.ti=new ki((t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=er(e)),e=tr(t.get(n),e);return er(e)}(t.path)),((t,e)=>t.isEqual(e))),this.garbageCollector=function(t,e){return new ko(t,e)}(this,e)}static Zr(t,e){return new Go(t,e)}zr(){}jr(t){return Wn.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Yn(t){const e=this.er(t);return this.persistence.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}er(t){let e=0;return this.Zn(t,(t=>{e++})).next((()=>e))}Zn(t,e){return Wn.forEach(this.ti,((n,r)=>this.nr(t,n,r).next((t=>t?Wn.resolve():e(r)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.Or(t,(r=>this.nr(t,r,e).next((t=>{t||(n++,i.removeEntry(r,Fn.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.ti.set(e,t.currentSequenceNumber),Wn.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.ti.set(n,t.currentSequenceNumber),Wn.resolve()}removeReference(t,e,n){return this.ti.set(n,t.currentSequenceNumber),Wn.resolve()}updateLimboDocument(t,e){return this.ti.set(e,t.currentSequenceNumber),Wn.resolve()}Wr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=xr(t.data.value)),e}nr(t,e,n){return Wn.or([()=>this.persistence.Hr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.ti.get(e);return Wn.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Ho{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.$i=n,this.Ui=r}static Wi(t,e){let n=ji(),r=ji();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Ho(t,e.fromCache,n,r)}}class Qo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Wo{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=!function(){var e;const n=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.Yi(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Zi(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new Qo;return this.Xi(t,e,n).next((r=>{if(i.result=r,this.zi)return this.es(t,e,n,r.size)}))})).next((()=>i.result))}es(t,e,n,r){return n.documentReadCount<this.ji?(pn()<=E.DEBUG&&gn("QueryEngine","SDK will not create cache indexes for query:",Ci(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Wn.resolve()):(pn()<=E.DEBUG&&gn("QueryEngine","Query:",Ci(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(pn()<=E.DEBUG&&gn("QueryEngine","The SDK decides to create cache indexes for query:",Ci(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,_i(e))):Wn.resolve())}Yi(t,e){if(vi(e))return Wn.resolve(null);let n=_i(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Ti(e,null,"F"),n=_i(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=ji(...r);return this.Ji.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.ts(e,r);return this.ns(e,s,i,n.readTime)?this.Yi(t,Ti(e,null,"F")):this.rs(t,s,e,n)}))))})))))}Zi(t,e,n,r){return vi(e)||r.isEqual(Fn.min())?Wn.resolve(null):this.Ji.getDocuments(t,n).next((i=>{const s=this.ts(e,i);return this.ns(e,s,n,r)?Wn.resolve(null):(pn()<=E.DEBUG&&gn("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ci(e)),this.rs(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Fn.fromTimestamp(1e9===r?new Vn(n+1,0):new Vn(n,r));return new Kn(i,$n.empty(),e)}(r,-1)).next((t=>t)))}))}ts(t,e){let n=new cr(Di(t));return e.forEach(((e,r)=>{Ai(t,r)&&(n=n.add(r))})),n}ns(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(t,e,n){return pn()<=E.DEBUG&&gn("QueryEngine","Using full collection scan to execute query:",Ci(e)),this.Ji.getDocumentsMatchingQuery(t,e,Kn.min(),n)}rs(t,e,n,r){return this.Ji.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Xo{constructor(t,e,n,r){this.persistence=t,this.ss=e,this.serializer=r,this.os=new sr(Mn),this._s=new ki((t=>fi(t)),pi),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(n)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Lo(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.os)))}}async function Yo(t,e){const n=_n(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.ls(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=ji();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({hs:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function Jo(t){const e=_n(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ur.getLastRemoteSnapshotVersion(t)))}function Zo(t,e){const n=_n(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function ta(t,e,n){const r=_n(t),i=r.os.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Xn(t))throw t;gn("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.os=r.os.remove(e),r._s.delete(i.target)}function ea(t,e,n){const r=_n(t);let i=Fn.min(),s=ji();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=_n(t),i=r._s.get(n);return void 0!==i?Wn.resolve(r.os.get(i)):r.Ur.getTargetData(e,n)}(r,t,_i(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.ss.getDocumentsMatchingQuery(t,e,n?i:Fn.min(),n?s:ji()))).next((t=>(function(t,e,n){let r=t.us.get(e)||Fn.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.us.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,Ts:s})))))}class na{constructor(){this.activeTargetIds=qi}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ra{constructor(){this.so=new na,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,n){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new na,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ia{_o(t){}shutdown(){}}class sa{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){gn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ho)t(0)}lo(){gn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ho)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let oa=null;function aa(){return null===oa?oa=268435456+Math.round(2147483648*Math.random()):oa++,"0x"+oa.toString(16)}const ca={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ua{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}}const la="WebChannelConnection";class ha extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=e+"://"+t.host,this.vo=`projects/${n}/databases/${r}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Fo(){return!1}Mo(t,e,n,r,i){const s=aa(),o=this.xo(t,e.toUriEncodedString());gn("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(a,r,i),this.No(t,o,a,n).then((e=>(gn("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw yn("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Lo(t,e,n,r,i,s){return this.Mo(t,e,n,r,i)}Oo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+dn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}xo(t,e){const n=ca[t];return`${this.Do}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,n,r){const i=aa();return new Promise(((s,o)=>{const a=new Ze;a.setWithCredentials(!0),a.listenOnce(en.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case nn.NO_ERROR:const e=a.getResponseJson();gn(la,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case nn.TIMEOUT:gn(la,`RPC '${t}' ${i} timed out`),o(new Tn(En.DEADLINE_EXCEEDED,"Request time out"));break;case nn.HTTP_ERROR:const n=a.getStatus();if(gn(la,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(En).indexOf(e)>=0?e:En.UNKNOWN}(e.status);o(new Tn(t,e.message))}else o(new Tn(En.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Tn(En.UNAVAILABLE,"Connection failed."));break;default:wn()}}finally{gn(la,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(r);gn(la,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",c,n,15)}))}Bo(t,e,n){const r=aa(),i=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=an(),o=on(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Oo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");gn(la,`Creating RPC '${t}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new ua({Io:e=>{d?gn(la,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(h||(gn(la,`Opening RPC '${t}' stream ${r} transport.`),l.open(),h=!0),gn(la,`RPC '${t}' stream ${r} sending:`,e),l.send(e))},To:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,tn.EventType.OPEN,(()=>{d||(gn(la,`RPC '${t}' stream ${r} transport opened.`),f.yo())})),p(l,tn.EventType.CLOSE,(()=>{d||(d=!0,gn(la,`RPC '${t}' stream ${r} transport closed`),f.So())})),p(l,tn.EventType.ERROR,(e=>{d||(d=!0,yn(la,`RPC '${t}' stream ${r} transport errored:`,e),f.So(new Tn(En.UNAVAILABLE,"The operation could not be completed")))})),p(l,tn.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];bn(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){gn(la,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Is[t];if(void 0!==e)return Cs(e)}(e),i=o.message;void 0===n&&(n=En.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.So(new Tn(n,i)),l.close()}else gn(la,`RPC '${t}' stream ${r} received:`,i),f.bo(i)}})),p(o,sn.STAT_EVENT,(e=>{e.stat===rn.PROXY?gn(la,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===rn.NOPROXY&&gn(la,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.wo()}),0),f}}function da(){return"undefined"!=typeof document?document:null}function fa(t){return new zs(t,!0)}class pa{constructor(t,e,n=1e3,r=1.5,i=6e4){this.ui=t,this.timerId=e,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const e=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,e-n);r>0&&gn("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,(()=>(this.Uo=Date.now(),t()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class ga{constructor(t,e,n,r,i,s,o,a){this.ui=t,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new pa(t,e)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(t){this.u_(),this.stream.send(t)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(t,e){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==t?this.t_.reset():e&&e.code===En.RESOURCE_EXHAUSTED?(mn(e.toString()),mn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===En.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.mo(e)}l_(){}auth(){this.state=1;const t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Yo===e&&this.P_(t,n)}),(e=>{t((()=>{const t=new Tn(En.UNKNOWN,"Fetching auth token failed: "+e.message);return this.I_(t)}))}))}P_(t,e){const n=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo((()=>{n((()=>this.listener.Eo()))})),this.stream.Ro((()=>{n((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((t=>{n((()=>this.I_(t)))})),this.stream.onMessage((t=>{n((()=>1==++this.e_?this.E_(t):this.onNext(t)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(t){return gn("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget((()=>this.Yo===t?e():(gn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ma extends ga{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}T_(t,e){return this.connection.Bo("Listen",t,e)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:wn()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(bn(void 0===e||"string"==typeof e),dr.fromBase64String(e||"")):(bn(void 0===e||e instanceof Buffer||e instanceof Uint8Array),dr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?En.UNKNOWN:Cs(t.code);return new Tn(e,t.message||"")}(o);n=new Ps(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=to(t,r.document.name),s=Ws(r.document.updateTime),o=r.document.createTime?Ws(r.document.createTime):Fn.min(),a=new jr({mapValue:{fields:r.document.fields}}),c=$r.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Os(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=to(t,r.document),s=r.readTime?Ws(r.readTime):Fn.min(),o=$r.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Os([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=to(t,r.document),s=r.removedTargetIds||[];n=new Os([],s,i,null)}else{if(!("filter"in e))return wn();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Ts(r,i),o=t.targetId;n=new Ms(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Fn.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Fn.min():e.readTime?Ws(e.readTime):Fn.min()}(t);return this.listener.d_(e,n)}A_(t){const e={};e.database=no(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=gi(r)?{documents:so(t,r)}:{query:oo(t,r)._t},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Hs(t,e.resumeToken);const r=Ks(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Fn.min())>0){n.readTime=Gs(t,e.snapshotVersion.toTimestamp());const r=Ks(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return wn()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.a_(e)}R_(t){const e={};e.database=no(this.serializer),e.removeTarget=t,this.a_(e)}}class ya extends ga{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return bn(!!t.streamToken),this.lastStreamToken=t.streamToken,bn(!t.writeResults||0===t.writeResults.length),this.listener.f_()}onNext(t){bn(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();const e=function(t,e){return t&&t.length>0?(bn(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ws(t.updateTime):Ws(e);return n.isEqual(Fn.min())&&(n=Ws(e)),new is(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ws(t.commitTime);return this.listener.g_(n,e)}p_(){const t={};t.database=no(this.serializer),this.a_(t)}m_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof fs)n={update:io(t,e.key,e.value)};else if(e instanceof vs)n={delete:Zs(t,e.key)};else if(e instanceof ps)n={update:io(t,e.key,e.data),updateMask:mo(e.fieldMask)};else{if(!(e instanceof ws))return wn();n={verify:Zs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Xi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Yi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Zi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof es)return{fieldPath:e.field.canonicalString(),increment:n.Pe};throw wn()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Qs(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:wn()}(t,e.precondition)),n}(this.serializer,t)))};this.a_(e)}}class va extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new Tn(En.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Mo(t,Ys(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===En.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Tn(En.UNKNOWN,t.toString())}))}Lo(t,e,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Lo(t,Ys(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===En.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Tn(En.UNKNOWN,t.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class wa{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(t){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,"Online"===t&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(mn(e),this.D_=!1):gn("OnlineStateTracker",e)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class ba{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o((t=>{n.enqueueAndForget((async()=>{Na(this)&&(gn("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=_n(t);e.L_.add(4),await Ea(e),e.q_.set("Unknown"),e.L_.delete(4),await _a(e)}(this))}))})),this.q_=new wa(n,r)}}async function _a(t){if(Na(t))for(const e of t.B_)await e(!0)}async function Ea(t){for(const e of t.B_)await e(!1)}function Ta(t,e){const n=_n(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),Da(n)?Aa(n):Ha(n).r_()&&Sa(n,e))}function Ia(t,e){const n=_n(t),r=Ha(n);n.N_.delete(e),r.r_()&&Ca(n,e),0===n.N_.size&&(r.r_()?r.o_():Na(n)&&n.q_.set("Unknown"))}function Sa(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Fn.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ha(t).A_(e)}function Ca(t,e){t.Q_.xe(e),Ha(t).R_(e)}function Aa(t){t.Q_=new Fs({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Ha(t).start(),t.q_.v_()}function Da(t){return Na(t)&&!Ha(t).n_()&&t.N_.size>0}function Na(t){return 0===_n(t).L_.size}function ka(t){t.Q_=void 0}async function xa(t){t.q_.set("Online")}async function Ra(t){t.N_.forEach(((e,n)=>{Sa(t,e)}))}async function La(t,e){ka(t),Da(t)?(t.q_.M_(e),Aa(t)):t.q_.set("Unknown")}async function Oa(t,e,n){if(t.q_.set("Online"),e instanceof Ps&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.N_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.N_.delete(r),t.Q_.removeTarget(r))}(t,e)}catch(n){gn("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ma(t,n)}else if(e instanceof Os?t.Q_.Ke(e):e instanceof Ms?t.Q_.He(e):t.Q_.We(e),!n.isEqual(Fn.min()))try{const e=await Jo(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Q_.rt(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.N_.get(r);i&&t.N_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.N_.get(e);if(!r)return;t.N_.set(e,r.withResumeToken(dr.EMPTY_BYTE_STRING,r.snapshotVersion)),Ca(t,e);const i=new vo(r.target,e,n,r.sequenceNumber);Sa(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){gn("RemoteStore","Failed to raise snapshot:",e),await Ma(t,e)}}async function Ma(t,e,n){if(!Xn(e))throw e;t.L_.add(1),await Ea(t),t.q_.set("Offline"),n||(n=()=>Jo(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{gn("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await _a(t)}))}function Pa(t,e){return e().catch((n=>Ma(t,n,e)))}async function Va(t){const e=_n(t),n=Qa(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Fa(e);)try{const t=await Zo(e.localStore,r);if(null===t){0===e.O_.length&&n.o_();break}r=t.batchId,Ua(e,t)}catch(t){await Ma(e,t)}Ba(e)&&ja(e)}function Fa(t){return Na(t)&&t.O_.length<10}function Ua(t,e){t.O_.push(e);const n=Qa(t);n.r_()&&n.V_&&n.m_(e.mutations)}function Ba(t){return Na(t)&&!Qa(t).n_()&&t.O_.length>0}function ja(t){Qa(t).start()}async function qa(t){Qa(t).p_()}async function $a(t){const e=Qa(t);for(const n of t.O_)e.m_(n.mutations)}async function za(t,e,n){const r=t.O_.shift(),i=_s.from(r,e,n);await Pa(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Va(t)}async function Ka(t,e){e&&Qa(t).V_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return wn();case En.CANCELLED:case En.UNKNOWN:case En.DEADLINE_EXCEEDED:case En.RESOURCE_EXHAUSTED:case En.INTERNAL:case En.UNAVAILABLE:case En.UNAUTHENTICATED:return!1;case En.INVALID_ARGUMENT:case En.NOT_FOUND:case En.ALREADY_EXISTS:case En.PERMISSION_DENIED:case En.FAILED_PRECONDITION:case En.ABORTED:case En.OUT_OF_RANGE:case En.UNIMPLEMENTED:case En.DATA_LOSS:return!0}}(t)&&t!==En.ABORTED}(e.code)){const n=t.O_.shift();Qa(t).s_(),await Pa(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Va(t)}}(t,e),Ba(t)&&ja(t)}async function Ga(t,e){const n=_n(t);n.asyncQueue.verifyOperationInProgress(),gn("RemoteStore","RemoteStore received new credentials");const r=Na(n);n.L_.add(3),await Ea(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await _a(n)}function Ha(t){return t.K_||(t.K_=function(t,e,n){const r=_n(t);return r.w_(),new ma(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Eo:xa.bind(null,t),Ro:Ra.bind(null,t),mo:La.bind(null,t),d_:Oa.bind(null,t)}),t.B_.push((async e=>{e?(t.K_.s_(),Da(t)?Aa(t):t.q_.set("Unknown")):(await t.K_.stop(),ka(t))}))),t.K_}function Qa(t){return t.U_||(t.U_=function(t,e,n){const r=_n(t);return r.w_(),new ya(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:qa.bind(null,t),mo:Ka.bind(null,t),f_:$a.bind(null,t),g_:za.bind(null,t)}),t.B_.push((async e=>{e?(t.U_.s_(),await Va(t)):(await t.U_.stop(),t.O_.length>0&&(gn("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))}))),t.U_}class Wa{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new In,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Wa(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Tn(En.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xa(t,e){if(mn("AsyncQueue",`${e}: ${t}`),Xn(t))return new Tn(En.UNAVAILABLE,`${e}: ${t}`);throw t}class Ya{constructor(t){this.comparator=t?(e,n)=>t(e,n)||$n.comparator(e.key,n.key):(t,e)=>$n.comparator(t.key,e.key),this.keyedMap=Oi(),this.sortedSet=new sr(this.comparator)}static emptySet(t){return new Ya(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Ya))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Ya;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Ja{constructor(){this.W_=new sr($n.comparator)}track(t){const e=t.doc.key,n=this.W_.get(e);n?0!==t.type&&3===n.type?this.W_=this.W_.insert(e,t):3===t.type&&1!==n.type?this.W_=this.W_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.W_=this.W_.remove(e):1===t.type&&2===n.type?this.W_=this.W_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):wn():this.W_=this.W_.insert(e,t)}G_(){const t=[];return this.W_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Za{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Za(t,e,Ya.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ii(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class tc{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((t=>t.J_()))}}class ec{constructor(){this.queries=nc(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,e){const n=_n(t),r=n.queries;n.queries=nc(),r.forEach(((t,n)=>{for(const t of n.j_)t.onError(e)}))}(this,new Tn(En.ABORTED,"Firestore shutting down"))}}function nc(){return new ki((t=>Si(t)),Ii)}function rc(t,e){const n=_n(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.j_)e.X_(t)&&(r=!0);i.z_=t}}r&&sc(n)}function ic(t,e,n){const r=_n(t),i=r.queries.get(e);if(i)for(const t of i.j_)t.onError(n);r.queries.delete(e)}function sc(t){t.Y_.forEach((t=>{t.next()}))}var oc,ac;(ac=oc||(oc={})).ea="default",ac.Cache="cache";class cc{constructor(t,e,n){this.query=t,this.ta=e,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Za(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.na?this.ia(t)&&(this.ta.next(t),e=!0):this.sa(t,this.onlineState)&&(this.oa(t),e=!0),this.ra=t,e}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}sa(t,e){if(!t.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==e;return(!this.options._a||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}ia(t){if(t.docChanges.length>0)return!0;const e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}oa(t){t=Za.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==oc.Cache}}class uc{constructor(t){this.key=t}}class lc{constructor(t){this.key=t}}class hc{constructor(t,e){this.query=t,this.Ta=e,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ji(),this.mutatedKeys=ji(),this.Aa=Di(t),this.Ra=new Ya(this.Aa)}get Va(){return this.Ta}ma(t,e){const n=e?e.fa:new Ja,r=e?e.Ra:this.Ra;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),l=Ai(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.ga(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Aa(l,a)>0||c&&this.Aa(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ra:s,fa:n,ns:o,mutatedKeys:i}}ga(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;const s=t.fa.G_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return wn()}};return n(t)-n(e)}(t.type,e.type)||this.Aa(t.doc,e.doc))),this.pa(n),r=null!=r&&r;const o=e&&!r?this.ya():[],a=0===this.da.size&&this.current&&!r?1:0,c=a!==this.Ea;return this.Ea=a,0!==s.length||c?{snapshot:new Za(this.query,t.Ra,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:o}:{wa:o}}Z_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Ja,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach((t=>this.Ta=this.Ta.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ta=this.Ta.delete(t))),this.current=t.current)}ya(){if(!this.current)return[];const t=this.da;this.da=ji(),this.Ra.forEach((t=>{this.Sa(t.key)&&(this.da=this.da.add(t.key))}));const e=[];return t.forEach((t=>{this.da.has(t)||e.push(new lc(t))})),this.da.forEach((n=>{t.has(n)||e.push(new uc(n))})),e}ba(t){this.Ta=t.Ts,this.da=ji();const e=this.ma(t.documents);return this.applyChanges(e,!0)}Da(){return Za.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class dc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class fc{constructor(t){this.key=t,this.va=!1}}class pc{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new ki((t=>Si(t)),Ii),this.Ma=new Map,this.xa=new Set,this.Oa=new sr($n.comparator),this.Na=new Map,this.La=new Vo,this.Ba={},this.ka=new Map,this.qa=Co.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function gc(t,e,n=!0){const r=Mc(t);let i;const s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=await yc(r,e,n,!0),i}async function mc(t,e){const n=Mc(t);await yc(n,e,!0,!1)}async function yc(t,e,n,r){const i=await function(t,e){const n=_n(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Ur.getTargetData(t,e).next((i=>i?(r=i,Wn.resolve(r)):n.Ur.allocateTargetId(t).next((i=>(r=new vo(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Ur.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.os.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(t.targetId,t),n._s.set(e,t.targetId)),t}))}(t.localStore,_i(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(t,e,n,r,i){t.Ka=(e,n,r)=>async function(t,e,n,r){let i=e.view.ma(n);i.ns&&(i=await ea(t.localStore,e.query,!1).then((({documents:t})=>e.view.ma(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return Nc(t,e.targetId,a.wa),a.snapshot}(t,e,n,r);const s=await ea(t.localStore,e,!0),o=new hc(e,s.Ts),a=o.ma(s.documents),c=Ls.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);Nc(t,n,u.wa);const l=new dc(e,n,o);return t.Fa.set(e,l),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),u.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&Ta(t.remoteStore,i),a}async function vc(t,e,n){const r=_n(t),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter((t=>!Ii(t,e)))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ta(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Ia(r.remoteStore,i.targetId),Ac(r,i.targetId)})).catch(Qn)):(Ac(r,i.targetId),await ta(r.localStore,i.targetId,!0))}async function wc(t,e){const n=_n(t),r=n.Fa.get(e),i=n.Ma.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Ia(n.remoteStore,r.targetId))}async function bc(t,e){const n=_n(t);try{const t=await function(t,e){const n=_n(t),r=e.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ur.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Ur.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(dr.EMPTY_BYTE_STRING,Fn.min()).withLastLimboFreeSnapshotVersion(Fn.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Ur.updateTargetData(t,u))}));let a=Ri(),c=ji();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=ji(),i=ji();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Ri();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Fn.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):gn("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Ps:r,Is:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.Ps,c=t.Is}))),!r.isEqual(Fn.min())){const e=n.Ur.getLastRemoteSnapshotVersion(t).next((e=>n.Ur.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Wn.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.os=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Na.get(e);r&&(bn(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.va=!0:t.modifiedDocuments.size>0?bn(r.va):t.removedDocuments.size>0&&(bn(r.va),r.va=!1))})),await Rc(n,t,e)}catch(t){await Qn(t)}}function _c(t,e,n){const r=_n(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.Fa.forEach(((n,r)=>{const i=r.view.Z_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=_n(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.j_)t.Z_(e)&&(r=!0)})),r&&sc(n)}(r.eventManager,e),t.length&&r.Ca.d_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Ec(t,e,n){const r=_n(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Na.get(e),s=i&&i.key;if(s){let t=new sr($n.comparator);t=t.insert(s,$r.newNoDocument(s,Fn.min()));const n=ji().add(s),i=new Rs(Fn.min(),new Map,new sr(Mn),t,n);await bc(r,i),r.Oa=r.Oa.remove(s),r.Na.delete(e),xc(r)}else await ta(r.localStore,e,!1).then((()=>Ac(r,e,n))).catch(Qn)}async function Tc(t,e){const n=_n(t),r=e.batch.batchId;try{const t=await function(t,e){const n=_n(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=Wn.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);bn(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ji();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Cc(n,r,null),Sc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Rc(n,t)}catch(t){await Qn(t)}}async function Ic(t,e,n){const r=_n(t);try{const t=await function(t,e){const n=_n(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(bn(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Cc(r,e,n),Sc(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Rc(r,t)}catch(n){await Qn(n)}}function Sc(t,e){(t.ka.get(e)||[]).forEach((t=>{t.resolve()})),t.ka.delete(e)}function Cc(t,e,n){const r=_n(t);let i=r.Ba[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function Ac(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach((e=>{t.La.containsKey(e)||Dc(t,e)}))}function Dc(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);null!==n&&(Ia(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),xc(t))}function Nc(t,e,n){for(const r of n)r instanceof uc?(t.La.addReference(r.key,e),kc(t,r)):r instanceof lc?(gn("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||Dc(t,r.key)):wn()}function kc(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(gn("SyncEngine","New document in limbo: "+n),t.xa.add(r),xc(t))}function xc(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new $n(Bn.fromString(e)),r=t.qa.next();t.Na.set(r,new fc(n)),t.Oa=t.Oa.insert(n,r),Ta(t.remoteStore,new vo(_i(yi(n.path)),r,"TargetPurposeLimboResolution",Yn.oe))}}async function Rc(t,e,n){const r=_n(t),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach(((t,a)=>{o.push(r.Ka(a,e,n).then((t=>{var e;if((t||n)&&r.isPrimaryClient){const i=t?!t.fromCache:null===(e=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);const e=Ho.Wi(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.Ca.d_(i),await async function(t,e){const n=_n(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Wn.forEach(e,(e=>Wn.forEach(e.$i,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Wn.forEach(e.Ui,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Xn(t))throw t;gn("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.os.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(e,i)}}}(r.localStore,s))}async function Lc(t,e){const n=_n(t);if(!n.currentUser.isEqual(e)){gn("SyncEngine","User change. New user:",e.toKey());const t=await Yo(n.localStore,e);n.currentUser=e,function(t){t.ka.forEach((t=>{t.forEach((t=>{t.reject(new Tn(En.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ka.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Rc(n,t.hs)}}function Oc(t,e){const n=_n(t),r=n.Na.get(e);if(r&&r.va)return ji().add(r.key);{let t=ji();const r=n.Ma.get(e);if(!r)return t;for(const e of r){const r=n.Fa.get(e);t=t.unionWith(r.view.Va)}return t}}function Mc(t){const e=_n(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=bc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Oc.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ec.bind(null,e),e.Ca.d_=rc.bind(null,e.eventManager),e.Ca.$a=ic.bind(null,e.eventManager),e}function Pc(t){const e=_n(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Tc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ic.bind(null,e),e}class Vc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=fa(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),await this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)}ja(t,e){return null}Ha(t,e){return null}za(t){return function(t,e,n,r){return new Xo(t,e,n,r)}(this.persistence,new Wo,t.initialUser,this.serializer)}Ga(t){return new $o(Ko.Zr,this.serializer)}Wa(t){return new ra}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Vc.provider={build:()=>new Vc};class Fc extends Vc{constructor(t){super(),this.cacheSizeBytes=t}ja(t,e){bn(this.persistence.referenceDelegate instanceof Go);const n=this.persistence.referenceDelegate.garbageCollector;return new No(n,t.asyncQueue,e)}Ga(t){const e=void 0!==this.cacheSizeBytes?So.withCacheSize(this.cacheSizeBytes):So.DEFAULT;return new $o((t=>Go.Zr(t,e)),this.serializer)}}class Uc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>_c(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Lc.bind(null,this.syncEngine),await async function(t,e){const n=_n(t);e?(n.L_.delete(2),await _a(n)):e||(n.L_.add(2),await Ea(n),n.q_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ec}createDatastore(t){const e=fa(t.databaseInfo.databaseId),n=function(t){return new ha(t)}(t.databaseInfo);return function(t,e,n,r){return new va(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new ba(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>_c(this.syncEngine,t,0)),sa.D()?new sa:new ia)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new pc(t,e,n,r,i,s);return o&&(a.Qa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=_n(t);gn("RemoteStore","RemoteStore shutting down."),e.L_.add(5),await Ea(e),e.k_.shutdown(),e.q_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}Uc.provider={build:()=>new Uc};class Bc{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):mn("Uncaught Error in snapshot listener:",t.toString()))}Za(){this.muted=!0}Ya(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}class jc{constructor(t,e,n,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=hn.UNAUTHENTICATED,this.clientId=On.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async t=>{gn("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(gn("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new In;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Xa(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function qc(t,e){t.asyncQueue.verifyOperationInProgress(),gn("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Yo(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function $c(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){gn("FirestoreClient","Using user provided OfflineComponentProvider");try{await qc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===En.FAILED_PRECONDITION||t.code===En.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;yn("Error using user provided cache. Falling back to memory cache: "+n),await qc(t,new Vc)}}else gn("FirestoreClient","Using default OfflineComponentProvider"),await qc(t,new Fc(void 0));return t._offlineComponents}(t);gn("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Ga(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Ga(e.remoteStore,n))),t._onlineComponents=e}async function zc(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(gn("FirestoreClient","Using user provided OnlineComponentProvider"),await $c(t,t._uninitializedComponentsProvider._online)):(gn("FirestoreClient","Using default OnlineComponentProvider"),await $c(t,new Uc))),t._onlineComponents}async function Kc(t){const e=await zc(t),n=e.eventManager;return n.onListen=gc.bind(null,e.syncEngine),n.onUnlisten=vc.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=mc.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=wc.bind(null,e.syncEngine),n}function Gc(t,e,n={}){const r=new In;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new Bc({next:n=>{s.Za(),e.enqueueAndForget((()=>async function(t,e){const n=_n(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.j_.indexOf(e);t>=0&&(s.j_.splice(t,1),0===s.j_.length?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o))),n.fromCache&&"server"===r.source?i.reject(new Tn(En.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new cc(n,s,{includeMetadataChanges:!0,_a:!0});return async function(t,e){const n=_n(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new tc,r=e.J_()?0:1);try{switch(r){case 0:s.z_=await n.onListen(i,!0);break;case 1:s.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=Xa(t,`Initialization of query '${Ci(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.j_.push(e),e.Z_(n.onlineState),s.z_&&e.X_(s.z_)&&sc(n)}(t,o)}(await Kc(t),t.asyncQueue,e,n,r))),r.promise}function Hc(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Qc=new Map;function Wc(t,e,n){if(!n)throw new Tn(En.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Xc(t){if(!$n.isDocumentKey(t))throw new Tn(En.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Yc(t){if($n.isDocumentKey(t))throw new Tn(En.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Jc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":wn()}function Zc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Tn(En.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Jc(t);throw new Tn(En.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class tu{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Tn(En.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Tn(En.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Tn(En.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Hc(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Tn(En.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Tn(En.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Tn(En.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class eu{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Tn(En.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Tn(En.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tu(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Cn;switch(t.type){case"firstParty":return new kn(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Tn(En.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Qc.get(t);e&&(gn("ComponentProvider","Removing Datastore"),Qc.delete(t),e.terminate())}(this),Promise.resolve()}}class nu{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new nu(this.firestore,t,this._query)}}class ru{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new iu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ru(this.firestore,t,this._key)}}class iu extends nu{constructor(t,e,n){super(t,e,yi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ru(this.firestore,null,new $n(t))}withConverter(t){return new iu(this.firestore,t,this._path)}}function su(t,e,...n){if(t=m(t),Wc("collection","path",e),t instanceof eu){const r=Bn.fromString(e,...n);return Yc(r),new iu(t,null,r)}{if(!(t instanceof ru||t instanceof iu))throw new Tn(En.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Bn.fromString(e,...n));return Yc(r),new iu(t.firestore,null,r)}}class ou{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new pa(this,"async_queue_retry"),this.Vu=()=>{const t=da();t&&gn("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()},this.mu=t;const e=da();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;const e=da();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise((()=>{}));const e=new In;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Pu.push(t),this.pu())))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!Xn(t))throw t;gn("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go((()=>this.pu()))}}gu(t){const e=this.mu.then((()=>(this.du=!0,t().catch((t=>{this.Eu=t,this.du=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw mn("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.du=!1,t))))));return this.mu=e,e}enqueueAfterDelay(t,e,n){this.fu(),this.Ru.indexOf(t)>-1&&(e=0);const r=Wa.createAndSchedule(this,t,e,n,(t=>this.yu(t)));return this.Tu.push(r),r}fu(){this.Eu&&wn()}verifyOperationInProgress(){}async wu(){let t;do{t=this.mu,await t}while(t!==this.mu)}Su(t){for(const e of this.Tu)if(e.timerId===t)return!0;return!1}bu(t){return this.wu().then((()=>{this.Tu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Tu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.wu()}))}Du(t){this.Ru.push(t)}yu(t){const e=this.Tu.indexOf(t);this.Tu.splice(e,1)}}class au extends eu{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new ou,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new ou(t),this._firestoreClient=void 0,await t}}}function cu(t){if(t._terminated)throw new Tn(En.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new br(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Hc(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new jc(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(t){const e=null==t?void 0:t._online.build();return{_offline:null==t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class uu{constructor(t){this._byteString=t}static fromBase64String(t){try{return new uu(dr.fromBase64String(t))}catch(t){throw new Tn(En.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new uu(dr.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class lu{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Tn(En.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qn(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class hu{constructor(t){this._methodName=t}}class du{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Tn(En.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Tn(En.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Mn(this._lat,t._lat)||Mn(this._long,t._long)}}class fu{constructor(t){this._values=(t||[]).map((t=>t))}toArray(){return this._values.map((t=>t))}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}}const pu=/^__.*__$/;class gu{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new ps(t,this.data,this.fieldMask,e,this.fieldTransforms):new fs(t,this.data,e,this.fieldTransforms)}}function mu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw wn()}}class yu{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new yu(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fu({path:n,xu:!1});return r.Ou(t),r}Nu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return Du(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(0===t.length)throw this.Bu("Document fields must not be empty");if(mu(this.Cu)&&pu.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}}class vu{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||fa(t)}Qu(t,e,n,r=!1){return new yu({Cu:t,methodName:e,qu:n,path:qn.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wu(t){const e=t._freezeSettings(),n=fa(t._databaseId);return new vu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function bu(t,e,n,r,i,s={}){const o=t.Qu(s.merge||s.mergeFields?2:0,e,n,i);Iu("Data must be an object, but it was:",o,r);const a=Eu(r,o);let c,u;if(s.merge)c=new lr(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=Su(e,r,n);if(!o.contains(i))throw new Tn(En.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Nu(t,i)||t.push(i)}c=new lr(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new gu(new jr(a),c,u)}function _u(t,e){if(Tu(t=m(t)))return Iu("Unsupported field value:",e,t),Eu(t,e);if(t instanceof hu)return function(t,e){if(!mu(e.Cu))throw e.Bu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Bu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&4!==e.Cu)throw e.Bu("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=_u(i,e.Lu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=m(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ki(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Vn.fromDate(t);return{timestampValue:Gs(e.serializer,n)}}if(t instanceof Vn){const n=new Vn(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Gs(e.serializer,n)}}if(t instanceof du)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof uu)return{bytesValue:Hs(e.serializer,t._byteString)};if(t instanceof ru){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Bu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Xs(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof fu)return function(t,e){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:t.toArray().map((t=>{if("number"!=typeof t)throw e.Bu("VectorValues must only contain numeric values.");return $i(e.serializer,t)}))}}}}}}(t,e);throw e.Bu(`Unsupported field value: ${Jc(t)}`)}(t,e)}function Eu(t,e){const n={};return ir(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):rr(t,((t,r)=>{const i=_u(r,e.Mu(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Tu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Vn||t instanceof du||t instanceof uu||t instanceof ru||t instanceof hu||t instanceof fu)}function Iu(t,e,n){if(!Tu(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Jc(n);throw"an object"===r?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function Su(t,e,n){if((e=m(e))instanceof lu)return e._internalPath;if("string"==typeof e)return Au(t,e);throw Du("Field path arguments must be of type string or ",t,!1,void 0,n)}const Cu=new RegExp("[~\\*/\\[\\]]");function Au(t,e,n){if(e.search(Cu)>=0)throw Du(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new lu(...e.split("."))._internalPath}catch(r){throw Du(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Du(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Tn(En.INVALID_ARGUMENT,a+t+c)}function Nu(t,e){return t.some((t=>t.isEqual(e)))}class ku{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ru(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new xu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Ru("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class xu extends ku{data(){return super.data()}}function Ru(t,e){return"string"==typeof e?Au(t,e):e instanceof lu?e._internalPath:e._delegate._internalPath}class Lu{}class Ou extends Lu{}function Mu(t,e,...n){let r=[];e instanceof Lu&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof Fu)).length,n=t.filter((t=>t instanceof Pu)).length;if(e>1||e>0&&n>0)throw new Tn(En.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}class Pu extends Ou{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Pu(t,e,n)}_apply(t){const e=this._parse(t);return qu(t._query,e),new nu(t.firestore,t.converter,Ei(t._query,e))}_parse(t){const e=wu(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Tn(En.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){ju(o,s);const e=[];for(const n of o)e.push(Bu(r,t,n));a={arrayValue:{values:e}}}else a=Bu(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||ju(o,s),a=function(t,e,n,r=!1){return _u(n,t.Qu(r?4:3,e))}(n,"where",o,"in"===s||"not-in"===s);return Xr.create(i,s,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function Vu(t,e,n){const r=e,i=Ru("where",t);return Pu._create(i,r,n)}class Fu extends Lu{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Fu(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:Yr.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)qu(n,t),n=Ei(n,t)}(t._query,e),new nu(t.firestore,t.converter,Ei(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Uu extends Ou{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Uu(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Tn(En.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Tn(En.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Hr(e,n)}(t._query,this._field,this._direction);return new nu(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new mi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Bu(t,e,n){if("string"==typeof(n=m(n))){if(""===n)throw new Tn(En.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wi(e)&&-1!==n.indexOf("/"))throw new Tn(En.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Bn.fromString(n));if(!$n.isDocumentKey(r))throw new Tn(En.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Rr(t,new $n(r))}if(n instanceof ru)return Rr(t,n._key);throw new Tn(En.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Jc(n)}.`)}function ju(t,e){if(!Array.isArray(t)||0===t.length)throw new Tn(En.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function qu(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Tn(En.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Tn(En.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class $u{convertValue(t,e="none"){switch(Tr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return gr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(mr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw wn()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return rr(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertVectorValue(t){var e,n,r;const i=null===(r=null===(n=null===(e=t.fields)||void 0===e?void 0:e.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((t=>gr(t.doubleValue)));return new fu(i)}convertGeoPoint(t){return new du(gr(t.latitude),gr(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=vr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(wr(t));default:return null}}convertTimestamp(t){const e=pr(t);return new Vn(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Bn.fromString(t);bn(yo(n));const r=new _r(n.get(1),n.get(3)),i=new $n(n.popFirst(5));return r.isEqual(e)||mn(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class zu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ku extends ku{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Gu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Ru("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Gu extends Ku{data(t={}){return super.data(t)}}class Hu{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new zu(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Gu(this._firestore,this._userDataWriter,n.key,n,new zu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Tn(En.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Gu(t._firestore,t._userDataWriter,n.doc.key,n.doc,new zu(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Gu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new zu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Qu(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Qu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return wn()}}class Wu extends $u{constructor(t){super(),this.firestore=t}convertBytes(t){return new uu(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ru(this.firestore,null,e)}}function Xu(t){t=Zc(t,nu);const e=Zc(t.firestore,au),n=cu(e),r=new Wu(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Tn(En.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),Gc(n,t._query).then((n=>new Hu(e,r,t,n)))}function Yu(t,e){const n=Zc(t.firestore,au),r=function(t,e,...n){if(t=m(t),1===arguments.length&&(e=On.newId()),Wc("doc","path",e),t instanceof eu){const r=Bn.fromString(e,...n);return Xc(r),new ru(t,null,new $n(r))}{if(!(t instanceof ru||t instanceof iu))throw new Tn(En.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Bn.fromString(e,...n));return Xc(r),new ru(t.firestore,t instanceof iu?t.converter:null,new $n(r))}}(t),i=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return function(t,e){return function(t,e){const n=new In;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Pc(t);try{const t=await function(t,e){const n=_n(t),r=Vn.now(),i=e.reduce(((t,e)=>t.add(e.key)),ji());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Ri(),c=ji();return n.cs.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=hs(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new ps(t.key,e,qr(e.value.mapValue),ss.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Mi(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Ba[t.currentUser.toKey()];r||(r=new sr(Mn)),r=r.insert(e,n),t.Ba[t.currentUser.toKey()]=r}(r,t.batchId,n),await Rc(r,t.changes),await Va(r.remoteStore)}catch(t){const e=Xa(t,"Failed to persist write");n.reject(e)}}(await function(t){return zc(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(cu(t),e)}(n,[bu(wu(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,ss.exists(!1))]).then((()=>r))}new WeakMap,function(t,e=!0){dn="11.0.1",At(new y("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new au(new Dn(t.getProvider("auth-internal")),new Rn(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Tn(En.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _r(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Lt(ln,"4.7.4",t),Lt(ln,"4.7.4","esm2017")}();const Ju=xt({apiKey:"AIzaSyDD0gscMahM2MXErIKIYT45bZXfVi6AkR4",authDomain:"quran-website-ab7ef.firebaseapp.com",projectId:"quran-website-ab7ef",storageBucket:"quran-website-ab7ef.firebasestorage.app",messagingSenderId:"382974773590",appId:"1:382974773590:web:fbfbf9776f1a7d7a6b2ef7",measurementId:"G-Y3X8V9TR4W"}),Zu=function(t){const e="string"==typeof t?t:"(default)",n=Dt("object"==typeof t?t:Rt(),"firestore").getImmediate({identifier:e});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const o=(t=Zc(t,eu))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&yn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=hn.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Tn(En.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new hn(o)}t._authCredentials=new An(new Sn(e,n))}}(n,...t)}return n}(Ju),tl=(function(t=Rt()){const e=Dt(t=m(t),Ie);e.isInitialized()?e.getImmediate():function(t,e={}){const n=Dt(t,Ie);if(n.isInitialized()){const t=n.getImmediate();if(f(e,n.getOptions()))return t;throw Ae.create("already-initialized")}n.initialize({options:e})}(t)}(Ju),"https://api.alquran.cloud/v1/surah"),el=localStorage.getItem("surahNumber"),nl=document.querySelector("#audioPlayer"),rl=document.querySelector("#ayahText"),il=document.querySelector("#ayahTextEn"),sl=document.querySelector("#ayahDetails"),ol=document.querySelector("#desc"),al=document.querySelector("#surahName"),cl=document.querySelector("#Ayahs_container"),ul=(document.querySelector("#tafasir_container"),document.getElementById("tafsir_Content")),ll=document.getElementById("tafsir_title"),hl=document.getElementById("toggleButton"),dl=document.getElementById("recent_reads");hl.addEventListener("click",(function(){ul.classList.toggle("hidden"),ul.classList.contains("hidden")?hl.innerHTML='<i class="fa-solid fa-angle-down"></i>':(ul.scrollIntoView({behavior:"smooth"}),hl.innerHTML='<i class="fa-solid fa-angle-up"></i>')})),async function(){const t=await fetch(`${tl}/${el}/ar.alafasy`),e=await t.json(),n=e.data.ayahs,r=await fetch(`${tl}/${el}/en.asad`),i=await r.json(),s=i.data.ayahs,o=await fetch(`${tl}/${el}/ar.muyassar`),a=await o.json(),c=a.data.ayahs;!async function(t,e){const n=await async function(){try{const t=await fetch("https://api.ipify.org?format=json");return(await t.json()).ip}catch(t){return console.error("Error fetching IP address:",t),null}}(),r=(new Date).toISOString();try{const i=new Date(r);i.setHours(0,0,0,0);const s=new Date(r);s.setHours(23,59,59,999);const o=Mu(su(Zu,"recentReads"),Vu("date",">=",i.toISOString()),Vu("date","<=",s.toISOString()),Vu("surahNumber","==",e));(await Xu(o)).empty?(await Yu(su(Zu,"recentReads"),{ipAddress:n,surahName:t,surahNumber:e,date:r}),console.log("Document added to recentReads!")):console.log("A read with the same date already exists.")}catch(t){console.error("Error adding document:",t)}try{const t=Mu(su(Zu,"recentReads"),Vu("ipAddress","==",n),function(t,e="asc"){const n=e,r=Ru("orderBy","date");return Uu._create(r,n)}(0,"desc"));(await Xu(t)).forEach((t=>{const e=new Date(t.data().date),n=new Date,r=Math.floor((n-e)/864e5);let i;i=0===r?"Today":1===r?"Yesterday":r<=7?"Last Week":e.getFullYear()===n.getFullYear()?e.toLocaleDateString("en-US",{month:"long"}):e.toLocaleDateString("en-US",{year:"numeric"});let s=document.getElementById(i);s||(s=document.createElement("div"),s.id=i,s.classList.add("w-full","flex","flex-col","items-start","justify-start","gap-2","pb-2"),s.innerHTML=`<h3 class='text-md font-semibold text-gray-400 px-2'>${i}</h3>`,dl.appendChild(s)),s.innerHTML+=`\n        <div  id='readSurah' data-value=${t.data().surahNumber} class="item flex p-2 w-full border border-[#343a40] rounded cursor-pointer hover:bg-[#343a40]">\n          <div class="item_details flex flex-col items-start justify-start px-2 w-full">\n              <div class="item_details_name flex items-center justify-between w-full">\n                  <div class="item_details_name_en text-lg font-semibold">Al-Mursalaat (The Emissaries)</div>\n                  <div class="item_details_name_ar text-lg font-light font-reemKufi" dir='rtl'>${t.data().surahName}</div>\n              </div>\n          </div>\n        </div>\n        `}))}catch(t){console.error("Error retrieving recent reads:",t)}}(e.data.name,e.data.number);const u="Medinan"==e.data.revelationType?"":"";al.innerHTML=`\n    <div class="">${e.data.name}</div>\n    <div class="">-</div>\n    <div class="">${e.data.englishName} (${e.data.englishNameTranslation})</div>`,ol.innerHTML=`\n    <div class="desc_info flex items-center justify-center py-2 px-4 rounded-full bg-white hover:bg-[#f0f0f0] cursor-pointer">${u}</div>\n    <div class="desc_info flex items-center justify-center py-2 px-4 rounded-full bg-white hover:bg-[#f0f0f0] cursor-pointer">${e.data.numberOfAyahs} </div>\n    <div class="desc_info flex items-center justify-center py-2 px-4 rounded-full bg-white hover:bg-[#f0f0f0] cursor-pointer"> ${e.data.edition.name}&nbsp;<span><i class="fa-solid fa-angle-down"></i></span></div>\n    <div class="desc_info flex items-center justify-center py-2 px-4 rounded-full bg-white hover:bg-[#f0f0f0] cursor-pointer"> ${i.data.edition.englishName}&nbsp;(${i.data.edition.language})&nbsp;<span><i class="fa-solid fa-angle-down"></i></span></div>\n    `;for(const t of n)cl.innerHTML+=`\n        <div class="ayah_container w-full h-12 p-0 hover:bg-[#343a40] border border-[#343a40] rounded flex items-center justify-between cursor-pointer shadow">\n            <div class="ayah_number bg-[#343a40] text-[#fff] text-lg font-extrabold w-[20%] h-full rounded-tl rounded-bl flex items-center justify-center shadow-[10px_0px_10px_0px_#1f2125] z-10">${t.numberInSurah}</div>\n            <div class="ayah text-sm text-white py-4 pr-4 w-[80%] h-full whitespace-nowrap overflow-hidden z-0" dir="rtl">${t.text}</div>\n        </div>`;const l=document.querySelectorAll("#Ayahs_container .ayah_number");let h=0;function d(){var t;h<n.length?(l.forEach(((t,e)=>{t.innerHTML=n[e].numberInSurah})),l[h].innerHTML='<i class="fa-solid fa-play [text-shadow:0px_0px_10px_rgba(255,255,255,0.8),0px_0px_100px_rgba(255,255,255,0.6),0px_0px_100px_rgba(255,255,255,0.4)]"></i>',t=h,ll.innerHTML=`${a.data.edition.name} - ${a.data.edition.englishName}`,ul.innerHTML=`${c[t].text}`,rl.innerHTML=n[h].text,il.innerHTML=s[h].text,sl.innerHTML=`\n            <div class="p-2 rounded-full bg-[#f0f0f0] text-black">  ${n[h].hizbQuarter}</div>\n            <div class="p-2 rounded-full bg-[#f0f0f0] text-black"> ${n[h].page}</div>\n            <div class="p-2 rounded-full bg-[#f0f0f0] text-black"> ${n[h].numberInSurah}</div>`,nl.src=n[h].audio,nl.load(),nl.play(),h++):(h=0,d())}nl.addEventListener("ended",d),d()}();const fl=document.getElementById("header");window.addEventListener("scroll",(()=>{window.scrollY>0?fl.classList.add("bg-[#1f2125]"):fl.classList.remove("bg-[#1f2125]")})),dl.addEventListener("click",(t=>{const e=t.target.closest("#readSurah");if(e){const t=e.getAttribute("data-value");localStorage.setItem("surahNumber",t),window.location.href="./"}}))})();